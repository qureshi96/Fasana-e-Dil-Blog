{"ast":null,"code":"import '@firebase/installations';\nimport { Component } from '@firebase/component';\nimport { ErrorFactory } from '@firebase/util';\nimport { __spread, __awaiter, __generator, __assign, __values } from 'tslib';\nimport { deleteDb, openDb } from 'idb';\nimport firebase from '@firebase/app';\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar _a;\n\nvar ERROR_MAP = (_a = {}, _a[\"missing-app-config-values\"\n/* MISSING_APP_CONFIG_VALUES */\n] = 'Missing App configuration value: \"{$valueName}\"', _a[\"only-available-in-window\"\n/* AVAILABLE_IN_WINDOW */\n] = 'This method is available in a Window context.', _a[\"only-available-in-sw\"\n/* AVAILABLE_IN_SW */\n] = 'This method is available in a service worker context.', _a[\"permission-default\"\n/* PERMISSION_DEFAULT */\n] = 'The notification permission was not granted and dismissed instead.', _a[\"permission-blocked\"\n/* PERMISSION_BLOCKED */\n] = 'The notification permission was not granted and blocked instead.', _a[\"unsupported-browser\"\n/* UNSUPPORTED_BROWSER */\n] = \"This browser doesn't support the API's required to use the firebase SDK.\", _a[\"failed-service-worker-registration\"\n/* FAILED_DEFAULT_REGISTRATION */\n] = 'We are unable to register the default service worker. {$browserErrorMessage}', _a[\"token-subscribe-failed\"\n/* TOKEN_SUBSCRIBE_FAILED */\n] = 'A problem occurred while subscribing the user to FCM: {$errorInfo}', _a[\"token-subscribe-no-token\"\n/* TOKEN_SUBSCRIBE_NO_TOKEN */\n] = 'FCM returned no token when subscribing the user to push.', _a[\"token-unsubscribe-failed\"\n/* TOKEN_UNSUBSCRIBE_FAILED */\n] = 'A problem occurred while unsubscribing the ' + 'user from FCM: {$errorInfo}', _a[\"token-update-failed\"\n/* TOKEN_UPDATE_FAILED */\n] = 'A problem occurred while updating the user from FCM: {$errorInfo}', _a[\"token-update-no-token\"\n/* TOKEN_UPDATE_NO_TOKEN */\n] = 'FCM returned no token when updating the user to push.', _a[\"use-sw-after-get-token\"\n/* USE_SW_AFTER_GET_TOKEN */\n] = 'The useServiceWorker() method may only be called once and must be ' + 'called before calling getToken() to ensure your service worker is used.', _a[\"invalid-sw-registration\"\n/* INVALID_SW_REGISTRATION */\n] = 'The input to useServiceWorker() must be a ServiceWorkerRegistration.', _a[\"invalid-bg-handler\"\n/* INVALID_BG_HANDLER */\n] = 'The input to setBackgroundMessageHandler() must be a function.', _a[\"invalid-vapid-key\"\n/* INVALID_VAPID_KEY */\n] = 'The public VAPID key must be a string.', _a[\"use-vapid-key-after-get-token\"\n/* USE_VAPID_KEY_AFTER_GET_TOKEN */\n] = 'The usePublicVapidKey() method may only be called once and must be ' + 'called before calling getToken() to ensure your VAPID key is used.', _a);\nvar ERROR_FACTORY = new ErrorFactory('messaging', 'Messaging', ERROR_MAP);\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar DEFAULT_SW_PATH = '/firebase-messaging-sw.js';\nvar DEFAULT_SW_SCOPE = '/firebase-cloud-messaging-push-scope';\nvar DEFAULT_VAPID_KEY = 'BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4';\nvar ENDPOINT = 'https://fcmregistrations.googleapis.com/v1';\n/** Key of FCM Payload in Notification's data field. */\n\nvar FCM_MSG = 'FCM_MSG';\nvar CONSOLE_CAMPAIGN_ID = 'google.c.a.c_id';\nvar CONSOLE_CAMPAIGN_NAME = 'google.c.a.c_l';\nvar CONSOLE_CAMPAIGN_TIME = 'google.c.a.ts';\n/** Set to '1' if Analytics is enabled for the campaign */\n\nvar CONSOLE_CAMPAIGN_ANALYTICS_ENABLED = 'google.c.a.e';\nvar TAG = 'FirebaseMessaging: ';\n/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\r\n * in compliance with the License. You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software distributed under the License\r\n * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\r\n * or implied. See the License for the specific language governing permissions and limitations under\r\n * the License.\r\n */\n\nvar MessageType;\n\n(function (MessageType) {\n  MessageType[\"PUSH_RECEIVED\"] = \"push-received\";\n  MessageType[\"NOTIFICATION_CLICKED\"] = \"notification-clicked\";\n})(MessageType || (MessageType = {}));\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction arrayToBase64(array) {\n  var uint8Array = new Uint8Array(array);\n  var base64String = btoa(String.fromCharCode.apply(String, __spread(uint8Array)));\n  return base64String.replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n\nfunction base64ToArray(base64String) {\n  var padding = '='.repeat((4 - base64String.length % 4) % 4);\n  var base64 = (base64String + padding).replace(/\\-/g, '+').replace(/_/g, '/');\n  var rawData = atob(base64);\n  var outputArray = new Uint8Array(rawData.length);\n\n  for (var i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n\n  return outputArray;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar OLD_DB_NAME = 'fcm_token_details_db';\n/**\r\n * The last DB version of 'fcm_token_details_db' was 4. This is one higher, so that the upgrade\r\n * callback is called for all versions of the old DB.\r\n */\n\nvar OLD_DB_VERSION = 5;\nvar OLD_OBJECT_STORE_NAME = 'fcm_token_object_Store';\n\nfunction migrateOldDatabase(senderId) {\n  return __awaiter(this, void 0, void 0, function () {\n    var databases, dbNames, tokenDetails, db;\n\n    var _this = this;\n\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          if (!('databases' in indexedDB)) return [3\n          /*break*/\n          , 2];\n          return [4\n          /*yield*/\n          , indexedDB.databases()];\n\n        case 1:\n          databases = _a.sent();\n          dbNames = databases.map(function (db) {\n            return db.name;\n          });\n\n          if (!dbNames.includes(OLD_DB_NAME)) {\n            // old DB didn't exist, no need to open.\n            return [2\n            /*return*/\n            , null];\n          }\n\n          _a.label = 2;\n\n        case 2:\n          tokenDetails = null;\n          return [4\n          /*yield*/\n          , openDb(OLD_DB_NAME, OLD_DB_VERSION, function (db) {\n            return __awaiter(_this, void 0, void 0, function () {\n              var objectStore, value, oldDetails, oldDetails, oldDetails;\n\n              var _a;\n\n              return __generator(this, function (_b) {\n                switch (_b.label) {\n                  case 0:\n                    if (db.oldVersion < 2) {\n                      // Database too old, skip migration.\n                      return [2\n                      /*return*/\n                      ];\n                    }\n\n                    if (!db.objectStoreNames.contains(OLD_OBJECT_STORE_NAME)) {\n                      // Database did not exist. Nothing to do.\n                      return [2\n                      /*return*/\n                      ];\n                    }\n\n                    objectStore = db.transaction.objectStore(OLD_OBJECT_STORE_NAME);\n                    return [4\n                    /*yield*/\n                    , objectStore.index('fcmSenderId').get(senderId)];\n\n                  case 1:\n                    value = _b.sent();\n                    return [4\n                    /*yield*/\n                    , objectStore.clear()];\n\n                  case 2:\n                    _b.sent();\n\n                    if (!value) {\n                      // No entry in the database, nothing to migrate.\n                      return [2\n                      /*return*/\n                      ];\n                    }\n\n                    if (db.oldVersion === 2) {\n                      oldDetails = value;\n\n                      if (!oldDetails.auth || !oldDetails.p256dh || !oldDetails.endpoint) {\n                        return [2\n                        /*return*/\n                        ];\n                      }\n\n                      tokenDetails = {\n                        token: oldDetails.fcmToken,\n                        createTime: (_a = oldDetails.createTime) !== null && _a !== void 0 ? _a : Date.now(),\n                        subscriptionOptions: {\n                          auth: oldDetails.auth,\n                          p256dh: oldDetails.p256dh,\n                          endpoint: oldDetails.endpoint,\n                          swScope: oldDetails.swScope,\n                          vapidKey: typeof oldDetails.vapidKey === 'string' ? oldDetails.vapidKey : arrayToBase64(oldDetails.vapidKey)\n                        }\n                      };\n                    } else if (db.oldVersion === 3) {\n                      oldDetails = value;\n                      tokenDetails = {\n                        token: oldDetails.fcmToken,\n                        createTime: oldDetails.createTime,\n                        subscriptionOptions: {\n                          auth: arrayToBase64(oldDetails.auth),\n                          p256dh: arrayToBase64(oldDetails.p256dh),\n                          endpoint: oldDetails.endpoint,\n                          swScope: oldDetails.swScope,\n                          vapidKey: arrayToBase64(oldDetails.vapidKey)\n                        }\n                      };\n                    } else if (db.oldVersion === 4) {\n                      oldDetails = value;\n                      tokenDetails = {\n                        token: oldDetails.fcmToken,\n                        createTime: oldDetails.createTime,\n                        subscriptionOptions: {\n                          auth: arrayToBase64(oldDetails.auth),\n                          p256dh: arrayToBase64(oldDetails.p256dh),\n                          endpoint: oldDetails.endpoint,\n                          swScope: oldDetails.swScope,\n                          vapidKey: arrayToBase64(oldDetails.vapidKey)\n                        }\n                      };\n                    }\n\n                    return [2\n                    /*return*/\n                    ];\n                }\n              });\n            });\n          })];\n\n        case 3:\n          db = _a.sent();\n          db.close(); // Delete all old databases.\n\n          return [4\n          /*yield*/\n          , deleteDb(OLD_DB_NAME)];\n\n        case 4:\n          // Delete all old databases.\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , deleteDb('fcm_vapid_details_db')];\n\n        case 5:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , deleteDb('undefined')];\n\n        case 6:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , checkTokenDetails(tokenDetails) ? tokenDetails : null];\n      }\n    });\n  });\n}\n\nfunction checkTokenDetails(tokenDetails) {\n  if (!tokenDetails || !tokenDetails.subscriptionOptions) {\n    return false;\n  }\n\n  var subscriptionOptions = tokenDetails.subscriptionOptions;\n  return typeof tokenDetails.createTime === 'number' && tokenDetails.createTime > 0 && typeof tokenDetails.token === 'string' && tokenDetails.token.length > 0 && typeof subscriptionOptions.auth === 'string' && subscriptionOptions.auth.length > 0 && typeof subscriptionOptions.p256dh === 'string' && subscriptionOptions.p256dh.length > 0 && typeof subscriptionOptions.endpoint === 'string' && subscriptionOptions.endpoint.length > 0 && typeof subscriptionOptions.swScope === 'string' && subscriptionOptions.swScope.length > 0 && typeof subscriptionOptions.vapidKey === 'string' && subscriptionOptions.vapidKey.length > 0;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n// Exported for tests.\n\n\nvar DATABASE_NAME = 'firebase-messaging-database';\nvar DATABASE_VERSION = 1;\nvar OBJECT_STORE_NAME = 'firebase-messaging-store';\nvar dbPromise = null;\n\nfunction getDbPromise() {\n  if (!dbPromise) {\n    dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDb) {\n      // We don't use 'break' in this switch statement, the fall-through behavior is what we want,\n      // because if there are multiple versions between the old version and the current version, we\n      // want ALL the migrations that correspond to those versions to run, not only the last one.\n      // eslint-disable-next-line default-case\n      switch (upgradeDb.oldVersion) {\n        case 0:\n          upgradeDb.createObjectStore(OBJECT_STORE_NAME);\n      }\n    });\n  }\n\n  return dbPromise;\n}\n/** Gets record(s) from the objectStore that match the given key. */\n\n\nfunction dbGet(firebaseDependencies) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tokenDetails, oldTokenDetails;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(firebaseDependencies);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          return [4\n          /*yield*/\n          , db.transaction(OBJECT_STORE_NAME).objectStore(OBJECT_STORE_NAME).get(key)];\n\n        case 2:\n          tokenDetails = _a.sent();\n          if (!tokenDetails) return [3\n          /*break*/\n          , 3];\n          return [2\n          /*return*/\n          , tokenDetails];\n\n        case 3:\n          return [4\n          /*yield*/\n          , migrateOldDatabase(firebaseDependencies.appConfig.senderId)];\n\n        case 4:\n          oldTokenDetails = _a.sent();\n          if (!oldTokenDetails) return [3\n          /*break*/\n          , 6];\n          return [4\n          /*yield*/\n          , dbSet(firebaseDependencies, oldTokenDetails)];\n\n        case 5:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , oldTokenDetails];\n\n        case 6:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/** Assigns or overwrites the record for the given key with the given value. */\n\n\nfunction dbSet(firebaseDependencies, tokenDetails) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(firebaseDependencies);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          return [4\n          /*yield*/\n          , tx.objectStore(OBJECT_STORE_NAME).put(tokenDetails, key)];\n\n        case 2:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 3:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , tokenDetails];\n      }\n    });\n  });\n}\n/** Removes record(s) from the objectStore that match the given key. */\n\n\nfunction dbRemove(firebaseDependencies) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(firebaseDependencies);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          return [4\n          /*yield*/\n          , tx.objectStore(OBJECT_STORE_NAME).delete(key)];\n\n        case 2:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 3:\n          _a.sent();\n\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction getKey(_a) {\n  var appConfig = _a.appConfig;\n  return appConfig.appId;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction requestGetToken(firebaseDependencies, subscriptionOptions) {\n  return __awaiter(this, void 0, void 0, function () {\n    var headers, body, subscribeOptions, responseData, response, err_1, message;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getHeaders(firebaseDependencies)];\n\n        case 1:\n          headers = _a.sent();\n          body = getBody(subscriptionOptions);\n          subscribeOptions = {\n            method: 'POST',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          _a.label = 2;\n\n        case 2:\n          _a.trys.push([2, 5,, 6]);\n\n          return [4\n          /*yield*/\n          , fetch(getEndpoint(firebaseDependencies.appConfig), subscribeOptions)];\n\n        case 3:\n          response = _a.sent();\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 4:\n          responseData = _a.sent();\n          return [3\n          /*break*/\n          , 6];\n\n        case 5:\n          err_1 = _a.sent();\n          throw ERROR_FACTORY.create(\"token-subscribe-failed\"\n          /* TOKEN_SUBSCRIBE_FAILED */\n          , {\n            errorInfo: err_1\n          });\n\n        case 6:\n          if (responseData.error) {\n            message = responseData.error.message;\n            throw ERROR_FACTORY.create(\"token-subscribe-failed\"\n            /* TOKEN_SUBSCRIBE_FAILED */\n            , {\n              errorInfo: message\n            });\n          }\n\n          if (!responseData.token) {\n            throw ERROR_FACTORY.create(\"token-subscribe-no-token\"\n            /* TOKEN_SUBSCRIBE_NO_TOKEN */\n            );\n          }\n\n          return [2\n          /*return*/\n          , responseData.token];\n      }\n    });\n  });\n}\n\nfunction requestUpdateToken(firebaseDependencies, tokenDetails) {\n  return __awaiter(this, void 0, void 0, function () {\n    var headers, body, updateOptions, responseData, response, err_2, message;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getHeaders(firebaseDependencies)];\n\n        case 1:\n          headers = _a.sent();\n          body = getBody(tokenDetails.subscriptionOptions);\n          updateOptions = {\n            method: 'PATCH',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          _a.label = 2;\n\n        case 2:\n          _a.trys.push([2, 5,, 6]);\n\n          return [4\n          /*yield*/\n          , fetch(getEndpoint(firebaseDependencies.appConfig) + \"/\" + tokenDetails.token, updateOptions)];\n\n        case 3:\n          response = _a.sent();\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 4:\n          responseData = _a.sent();\n          return [3\n          /*break*/\n          , 6];\n\n        case 5:\n          err_2 = _a.sent();\n          throw ERROR_FACTORY.create(\"token-update-failed\"\n          /* TOKEN_UPDATE_FAILED */\n          , {\n            errorInfo: err_2\n          });\n\n        case 6:\n          if (responseData.error) {\n            message = responseData.error.message;\n            throw ERROR_FACTORY.create(\"token-update-failed\"\n            /* TOKEN_UPDATE_FAILED */\n            , {\n              errorInfo: message\n            });\n          }\n\n          if (!responseData.token) {\n            throw ERROR_FACTORY.create(\"token-update-no-token\"\n            /* TOKEN_UPDATE_NO_TOKEN */\n            );\n          }\n\n          return [2\n          /*return*/\n          , responseData.token];\n      }\n    });\n  });\n}\n\nfunction requestDeleteToken(firebaseDependencies, token) {\n  return __awaiter(this, void 0, void 0, function () {\n    var headers, unsubscribeOptions, response, responseData, message, err_3;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getHeaders(firebaseDependencies)];\n\n        case 1:\n          headers = _a.sent();\n          unsubscribeOptions = {\n            method: 'DELETE',\n            headers: headers\n          };\n          _a.label = 2;\n\n        case 2:\n          _a.trys.push([2, 5,, 6]);\n\n          return [4\n          /*yield*/\n          , fetch(getEndpoint(firebaseDependencies.appConfig) + \"/\" + token, unsubscribeOptions)];\n\n        case 3:\n          response = _a.sent();\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 4:\n          responseData = _a.sent();\n\n          if (responseData.error) {\n            message = responseData.error.message;\n            throw ERROR_FACTORY.create(\"token-unsubscribe-failed\"\n            /* TOKEN_UNSUBSCRIBE_FAILED */\n            , {\n              errorInfo: message\n            });\n          }\n\n          return [3\n          /*break*/\n          , 6];\n\n        case 5:\n          err_3 = _a.sent();\n          throw ERROR_FACTORY.create(\"token-unsubscribe-failed\"\n          /* TOKEN_UNSUBSCRIBE_FAILED */\n          , {\n            errorInfo: err_3\n          });\n\n        case 6:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction getEndpoint(_a) {\n  var projectId = _a.projectId;\n  return ENDPOINT + \"/projects/\" + projectId + \"/registrations\";\n}\n\nfunction getHeaders(_a) {\n  var appConfig = _a.appConfig,\n      installations = _a.installations;\n  return __awaiter(this, void 0, void 0, function () {\n    var authToken;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , installations.getToken()];\n\n        case 1:\n          authToken = _b.sent();\n          return [2\n          /*return*/\n          , new Headers({\n            'Content-Type': 'application/json',\n            Accept: 'application/json',\n            'x-goog-api-key': appConfig.apiKey,\n            'x-goog-firebase-installations-auth': \"FIS \" + authToken\n          })];\n      }\n    });\n  });\n}\n\nfunction getBody(_a) {\n  var p256dh = _a.p256dh,\n      auth = _a.auth,\n      endpoint = _a.endpoint,\n      vapidKey = _a.vapidKey;\n  var body = {\n    web: {\n      endpoint: endpoint,\n      auth: auth,\n      p256dh: p256dh\n    }\n  };\n\n  if (vapidKey !== DEFAULT_VAPID_KEY) {\n    body.web.applicationPubKey = vapidKey;\n  }\n\n  return body;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/** UpdateRegistration will be called once every week. */\n\n\nvar TOKEN_EXPIRATION_MS = 7 * 24 * 60 * 60 * 1000; // 7 days\n\nfunction getToken(firebaseDependencies, swRegistration, vapidKey) {\n  return __awaiter(this, void 0, void 0, function () {\n    var pushSubscription, tokenDetails, subscriptionOptions, e_1;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          if (Notification.permission !== 'granted') {\n            throw ERROR_FACTORY.create(\"permission-blocked\"\n            /* PERMISSION_BLOCKED */\n            );\n          }\n\n          return [4\n          /*yield*/\n          , getPushSubscription(swRegistration, vapidKey)];\n\n        case 1:\n          pushSubscription = _a.sent();\n          return [4\n          /*yield*/\n          , dbGet(firebaseDependencies)];\n\n        case 2:\n          tokenDetails = _a.sent();\n          subscriptionOptions = {\n            vapidKey: vapidKey,\n            swScope: swRegistration.scope,\n            endpoint: pushSubscription.endpoint,\n            auth: arrayToBase64(pushSubscription.getKey('auth')),\n            p256dh: arrayToBase64(pushSubscription.getKey('p256dh'))\n          };\n          if (!!tokenDetails) return [3\n          /*break*/\n          , 3]; // No token, get a new one.\n\n          return [2\n          /*return*/\n          , getNewToken(firebaseDependencies, subscriptionOptions)];\n\n        case 3:\n          if (!!isTokenValid(tokenDetails.subscriptionOptions, subscriptionOptions)) return [3\n          /*break*/\n          , 8];\n          _a.label = 4;\n\n        case 4:\n          _a.trys.push([4, 6,, 7]);\n\n          return [4\n          /*yield*/\n          , requestDeleteToken(firebaseDependencies, tokenDetails.token)];\n\n        case 5:\n          _a.sent();\n\n          return [3\n          /*break*/\n          , 7];\n\n        case 6:\n          e_1 = _a.sent(); // Suppress errors because of #2364\n\n          console.warn(e_1);\n          return [3\n          /*break*/\n          , 7];\n\n        case 7:\n          return [2\n          /*return*/\n          , getNewToken(firebaseDependencies, subscriptionOptions)];\n\n        case 8:\n          if (Date.now() >= tokenDetails.createTime + TOKEN_EXPIRATION_MS) {\n            // Weekly token refresh\n            return [2\n            /*return*/\n            , updateToken({\n              token: tokenDetails.token,\n              createTime: Date.now(),\n              subscriptionOptions: subscriptionOptions\n            }, firebaseDependencies, swRegistration)];\n          } else {\n            // Valid token, nothing to do.\n            return [2\n            /*return*/\n            , tokenDetails.token];\n          }\n\n        case 9:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/**\r\n * This method deletes the token from the database, unsubscribes the token from FCM, and unregisters\r\n * the push subscription if it exists.\r\n */\n\n\nfunction deleteToken(firebaseDependencies, swRegistration) {\n  return __awaiter(this, void 0, void 0, function () {\n    var tokenDetails, pushSubscription;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , dbGet(firebaseDependencies)];\n\n        case 1:\n          tokenDetails = _a.sent();\n          if (!tokenDetails) return [3\n          /*break*/\n          , 4];\n          return [4\n          /*yield*/\n          , requestDeleteToken(firebaseDependencies, tokenDetails.token)];\n\n        case 2:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , dbRemove(firebaseDependencies)];\n\n        case 3:\n          _a.sent();\n\n          _a.label = 4;\n\n        case 4:\n          return [4\n          /*yield*/\n          , swRegistration.pushManager.getSubscription()];\n\n        case 5:\n          pushSubscription = _a.sent();\n\n          if (pushSubscription) {\n            return [2\n            /*return*/\n            , pushSubscription.unsubscribe()];\n          } // If there's no SW, consider it a success.\n\n\n          return [2\n          /*return*/\n          , true];\n      }\n    });\n  });\n}\n\nfunction updateToken(tokenDetails, firebaseDependencies, swRegistration) {\n  return __awaiter(this, void 0, void 0, function () {\n    var updatedToken, updatedTokenDetails, e_2;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          _a.trys.push([0, 3,, 5]);\n\n          return [4\n          /*yield*/\n          , requestUpdateToken(firebaseDependencies, tokenDetails)];\n\n        case 1:\n          updatedToken = _a.sent();\n          updatedTokenDetails = __assign(__assign({}, tokenDetails), {\n            token: updatedToken,\n            createTime: Date.now()\n          });\n          return [4\n          /*yield*/\n          , dbSet(firebaseDependencies, updatedTokenDetails)];\n\n        case 2:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , updatedToken];\n\n        case 3:\n          e_2 = _a.sent();\n          return [4\n          /*yield*/\n          , deleteToken(firebaseDependencies, swRegistration)];\n\n        case 4:\n          _a.sent();\n\n          throw e_2;\n\n        case 5:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction getNewToken(firebaseDependencies, subscriptionOptions) {\n  return __awaiter(this, void 0, void 0, function () {\n    var token, tokenDetails;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , requestGetToken(firebaseDependencies, subscriptionOptions)];\n\n        case 1:\n          token = _a.sent();\n          tokenDetails = {\n            token: token,\n            createTime: Date.now(),\n            subscriptionOptions: subscriptionOptions\n          };\n          return [4\n          /*yield*/\n          , dbSet(firebaseDependencies, tokenDetails)];\n\n        case 2:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , tokenDetails.token];\n      }\n    });\n  });\n}\n/**\r\n * Gets a PushSubscription for the current user.\r\n */\n\n\nfunction getPushSubscription(swRegistration, vapidKey) {\n  return __awaiter(this, void 0, void 0, function () {\n    var subscription;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , swRegistration.pushManager.getSubscription()];\n\n        case 1:\n          subscription = _a.sent();\n\n          if (subscription) {\n            return [2\n            /*return*/\n            , subscription];\n          }\n\n          return [2\n          /*return*/\n          , swRegistration.pushManager.subscribe({\n            userVisibleOnly: true,\n            // Chrome <= 75 doesn't support base64-encoded VAPID key. For backward compatibility, VAPID key\n            // submitted to pushManager#subscribe must be of type Uint8Array.\n            applicationServerKey: base64ToArray(vapidKey)\n          })];\n      }\n    });\n  });\n}\n/**\r\n * Checks if the saved tokenDetails object matches the configuration provided.\r\n */\n\n\nfunction isTokenValid(dbOptions, currentOptions) {\n  var isVapidKeyEqual = currentOptions.vapidKey === dbOptions.vapidKey;\n  var isEndpointEqual = currentOptions.endpoint === dbOptions.endpoint;\n  var isAuthEqual = currentOptions.auth === dbOptions.auth;\n  var isP256dhEqual = currentOptions.p256dh === dbOptions.p256dh;\n  return isVapidKeyEqual && isEndpointEqual && isAuthEqual && isP256dhEqual;\n}\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction externalizePayload(internalPayload) {\n  var payload = {\n    from: internalPayload.from,\n    // eslint-disable-next-line camelcase\n    collapseKey: internalPayload.collapse_key\n  };\n  propagateNotificationPayload(payload, internalPayload);\n  propagateDataPayload(payload, internalPayload);\n  propagateFcmOptions(payload, internalPayload);\n  return payload;\n}\n\nfunction propagateNotificationPayload(payload, messagePayloadInternal) {\n  if (!messagePayloadInternal.notification) {\n    return;\n  }\n\n  payload.notification = {};\n  var title = messagePayloadInternal.notification.title;\n\n  if (!!title) {\n    payload.notification.title = title;\n  }\n\n  var body = messagePayloadInternal.notification.body;\n\n  if (!!body) {\n    payload.notification.body = body;\n  }\n\n  var image = messagePayloadInternal.notification.image;\n\n  if (!!image) {\n    payload.notification.image = image;\n  }\n}\n\nfunction propagateDataPayload(payload, messagePayloadInternal) {\n  if (!messagePayloadInternal.data) {\n    return;\n  }\n\n  payload.data = messagePayloadInternal.data;\n}\n\nfunction propagateFcmOptions(payload, messagePayloadInternal) {\n  if (!messagePayloadInternal.fcmOptions) {\n    return;\n  }\n\n  payload.fcmOptions = {};\n  var link = messagePayloadInternal.fcmOptions.link;\n\n  if (!!link) {\n    payload.fcmOptions.link = link;\n  } // eslint-disable-next-line camelcase\n\n\n  var analyticsLabel = messagePayloadInternal.fcmOptions.analytics_label;\n\n  if (!!analyticsLabel) {\n    payload.fcmOptions.analyticsLabel = analyticsLabel;\n  }\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction isConsoleMessage(data) {\n  // This message has a campaign ID, meaning it was sent using the Firebase Console.\n  return typeof data === 'object' && !!data && CONSOLE_CAMPAIGN_ID in data;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/** Returns a promise that resolves after given time passes. */\n\n\nfunction sleep(ms) {\n  return new Promise(function (resolve) {\n    setTimeout(resolve, ms);\n  });\n}\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar SwController =\n/** @class */\nfunction () {\n  function SwController(firebaseDependencies) {\n    var _this = this;\n\n    this.firebaseDependencies = firebaseDependencies; // A boolean flag to determine wether an app is using onBackgroundMessage or\n    // setBackgroundMessageHandler. onBackgroundMessage will receive a MessagePayload regardless of if\n    // a notification is displayed. Whereas, setBackgroundMessageHandler will swallow the\n    // MessagePayload if a NotificationPayload is included.\n\n    this.isOnBackgroundMessageUsed = null;\n    this.vapidKey = null;\n    this.bgMessageHandler = null;\n    self.addEventListener('push', function (e) {\n      e.waitUntil(_this.onPush(e));\n    });\n    self.addEventListener('pushsubscriptionchange', function (e) {\n      e.waitUntil(_this.onSubChange(e));\n    });\n    self.addEventListener('notificationclick', function (e) {\n      e.waitUntil(_this.onNotificationClick(e));\n    });\n  }\n\n  Object.defineProperty(SwController.prototype, \"app\", {\n    get: function () {\n      return this.firebaseDependencies.app;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\r\n   * @deprecated. Use onBackgroundMessage(nextOrObserver: NextFn<object> | Observer<object>):\r\n   * Unsubscribe instead.\r\n   *\r\n   * Calling setBackgroundMessageHandler will opt in to some specific behaviors.\r\n   *\r\n   * 1.) If a notification doesn't need to be shown due to a window already being visible, then push\r\n   * messages will be sent to the page. 2.) If a notification needs to be shown, and the message\r\n   * contains no notification data this method will be called and the promise it returns will be\r\n   * passed to event.waitUntil. If you do not set this callback then all push messages will let and\r\n   * the developer can handle them in a their own 'push' event callback\r\n   *\r\n   * @param callback The callback to be called when a push message is received and a notification\r\n   * must be shown. The callback will be given the data from the push message.\r\n   */\n\n  SwController.prototype.setBackgroundMessageHandler = function (callback) {\n    this.isOnBackgroundMessageUsed = false;\n\n    if (!callback || typeof callback !== 'function') {\n      throw ERROR_FACTORY.create(\"invalid-bg-handler\"\n      /* INVALID_BG_HANDLER */\n      );\n    }\n\n    this.bgMessageHandler = callback;\n  };\n\n  SwController.prototype.onBackgroundMessage = function (nextOrObserver) {\n    var _this = this;\n\n    this.isOnBackgroundMessageUsed = true;\n    this.bgMessageHandler = nextOrObserver;\n    return function () {\n      _this.bgMessageHandler = null;\n    };\n  }; // TODO: Remove getToken from SW Controller. Calling this from an old SW can cause all kinds of\n  // trouble.\n\n\n  SwController.prototype.getToken = function () {\n    var _a, _b;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var tokenDetails;\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            if (!!this.vapidKey) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , dbGet(this.firebaseDependencies)];\n\n          case 1:\n            tokenDetails = _c.sent();\n            this.vapidKey = (_b = (_a = tokenDetails === null || tokenDetails === void 0 ? void 0 : tokenDetails.subscriptionOptions) === null || _a === void 0 ? void 0 : _a.vapidKey) !== null && _b !== void 0 ? _b : DEFAULT_VAPID_KEY;\n            _c.label = 2;\n\n          case 2:\n            return [2\n            /*return*/\n            , getToken(this.firebaseDependencies, self.registration, this.vapidKey)];\n        }\n      });\n    });\n  }; // TODO: Remove deleteToken from SW Controller. Calling this from an old SW can cause all kinds of\n  // trouble.\n\n\n  SwController.prototype.deleteToken = function () {\n    return deleteToken(this.firebaseDependencies, self.registration);\n  };\n\n  SwController.prototype.requestPermission = function () {\n    throw ERROR_FACTORY.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  }; // TODO: Remove this together with getToken from SW Controller.\n\n\n  SwController.prototype.usePublicVapidKey = function (vapidKey) {\n    if (this.vapidKey !== null) {\n      throw ERROR_FACTORY.create(\"use-vapid-key-after-get-token\"\n      /* USE_VAPID_KEY_AFTER_GET_TOKEN */\n      );\n    }\n\n    if (typeof vapidKey !== 'string' || vapidKey.length === 0) {\n      throw ERROR_FACTORY.create(\"invalid-vapid-key\"\n      /* INVALID_VAPID_KEY */\n      );\n    }\n\n    this.vapidKey = vapidKey;\n  };\n\n  SwController.prototype.useServiceWorker = function () {\n    throw ERROR_FACTORY.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  };\n\n  SwController.prototype.onMessage = function () {\n    throw ERROR_FACTORY.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  };\n\n  SwController.prototype.onTokenRefresh = function () {\n    throw ERROR_FACTORY.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  };\n  /**\r\n   * A handler for push events that shows notifications based on the content of the payload.\r\n   *\r\n   * The payload must be a JSON-encoded Object with a `notification` key. The value of the\r\n   * `notification` property will be used as the NotificationOptions object passed to\r\n   * showNotification. Additionally, the `title` property of the notification object will be used as\r\n   * the title.\r\n   *\r\n   * If there is no notification data in the payload then no notification will be shown.\r\n   */\n\n\n  SwController.prototype.onPush = function (event) {\n    return __awaiter(this, void 0, void 0, function () {\n      var internalPayload, clientList, isNotificationShown, payload;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            internalPayload = getMessagePayloadInternal(event);\n\n            if (!internalPayload) {\n              console.debug(TAG + 'failed to get parsed MessagePayload from the PushEvent. Skip handling the push.');\n              return [2\n              /*return*/\n              ];\n            }\n\n            return [4\n            /*yield*/\n            , getClientList()];\n\n          case 1:\n            clientList = _a.sent();\n\n            if (hasVisibleClients(clientList)) {\n              return [2\n              /*return*/\n              , sendMessagePayloadInternalToWindows(clientList, internalPayload)];\n            }\n\n            isNotificationShown = false;\n            if (!!!internalPayload.notification) return [3\n            /*break*/\n            , 3];\n            return [4\n            /*yield*/\n            , showNotification(wrapInternalPayload(internalPayload))];\n\n          case 2:\n            _a.sent();\n\n            isNotificationShown = true;\n            _a.label = 3;\n\n          case 3:\n            // MessagePayload is only passed to `onBackgroundMessage`. Skip passing MessagePayload for\n            // the legacy `setBackgroundMessageHandler` to preserve the SDK behaviors.\n            if (isNotificationShown === true && this.isOnBackgroundMessageUsed === false) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            if (!!this.bgMessageHandler) {\n              payload = externalizePayload(internalPayload);\n\n              if (typeof this.bgMessageHandler === 'function') {\n                this.bgMessageHandler(payload);\n              } else {\n                this.bgMessageHandler.next(payload);\n              }\n            }\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  SwController.prototype.onSubChange = function (event) {\n    var _a, _b;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var newSubscription, tokenDetails;\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            newSubscription = event.newSubscription;\n            if (!!newSubscription) return [3\n            /*break*/\n            , 2]; // Subscription revoked, delete token\n\n            return [4\n            /*yield*/\n            , deleteToken(this.firebaseDependencies, self.registration)];\n\n          case 1:\n            // Subscription revoked, delete token\n            _c.sent();\n\n            return [2\n            /*return*/\n            ];\n\n          case 2:\n            return [4\n            /*yield*/\n            , dbGet(this.firebaseDependencies)];\n\n          case 3:\n            tokenDetails = _c.sent();\n            return [4\n            /*yield*/\n            , deleteToken(this.firebaseDependencies, self.registration)];\n\n          case 4:\n            _c.sent();\n\n            return [4\n            /*yield*/\n            , getToken(this.firebaseDependencies, self.registration, (_b = (_a = tokenDetails === null || tokenDetails === void 0 ? void 0 : tokenDetails.subscriptionOptions) === null || _a === void 0 ? void 0 : _a.vapidKey) !== null && _b !== void 0 ? _b : DEFAULT_VAPID_KEY)];\n\n          case 5:\n            _c.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  SwController.prototype.onNotificationClick = function (event) {\n    var _a, _b;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var internalPayload, link, url, originUrl, client;\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            internalPayload = (_b = (_a = event.notification) === null || _a === void 0 ? void 0 : _a.data) === null || _b === void 0 ? void 0 : _b[FCM_MSG];\n\n            if (!internalPayload) {\n              return [2\n              /*return*/\n              ];\n            } else if (event.action) {\n              // User clicked on an action button. This will allow developers to act on action button clicks\n              // by using a custom onNotificationClick listener that they define.\n              return [2\n              /*return*/\n              ];\n            } // Prevent other listeners from receiving the event\n\n\n            event.stopImmediatePropagation();\n            event.notification.close();\n            link = getLink(internalPayload);\n\n            if (!link) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            url = new URL(link, self.location.href);\n            originUrl = new URL(self.location.origin);\n\n            if (url.host !== originUrl.host) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            return [4\n            /*yield*/\n            , getWindowClient(url)];\n\n          case 1:\n            client = _c.sent();\n            if (!!client) return [3\n            /*break*/\n            , 4];\n            return [4\n            /*yield*/\n            , self.clients.openWindow(link)];\n\n          case 2:\n            client = _c.sent(); // Wait three seconds for the client to initialize and set up the message handler so that it\n            // can receive the message.\n\n            return [4\n            /*yield*/\n            , sleep(3000)];\n\n          case 3:\n            // Wait three seconds for the client to initialize and set up the message handler so that it\n            // can receive the message.\n            _c.sent();\n\n            return [3\n            /*break*/\n            , 6];\n\n          case 4:\n            return [4\n            /*yield*/\n            , client.focus()];\n\n          case 5:\n            client = _c.sent();\n            _c.label = 6;\n\n          case 6:\n            if (!client) {\n              // Window Client will not be returned if it's for a third party origin.\n              return [2\n              /*return*/\n              ];\n            }\n\n            internalPayload.messageType = MessageType.NOTIFICATION_CLICKED;\n            internalPayload.isFirebaseMessaging = true;\n            return [2\n            /*return*/\n            , client.postMessage(internalPayload)];\n        }\n      });\n    });\n  };\n\n  return SwController;\n}();\n\nfunction wrapInternalPayload(internalPayload) {\n  var _a;\n\n  var wrappedInternalPayload = __assign({}, internalPayload.notification); // Put the message payload under FCM_MSG name so we can identify the notification as being an FCM\n  // notification vs a notification from somewhere else (i.e. normal web push or developer generated\n  // notification).\n\n\n  wrappedInternalPayload.data = (_a = {}, _a[FCM_MSG] = internalPayload, _a);\n  return wrappedInternalPayload;\n}\n\nfunction getMessagePayloadInternal(_a) {\n  var data = _a.data;\n\n  if (!data) {\n    return null;\n  }\n\n  try {\n    return data.json();\n  } catch (err) {\n    // Not JSON so not an FCM message.\n    return null;\n  }\n}\n/**\r\n * @param url The URL to look for when focusing a client.\r\n * @return Returns an existing window client or a newly opened WindowClient.\r\n */\n\n\nfunction getWindowClient(url) {\n  return __awaiter(this, void 0, void 0, function () {\n    var clientList, clientList_1, clientList_1_1, client, clientUrl;\n\n    var e_1, _a;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getClientList()];\n\n        case 1:\n          clientList = _b.sent();\n\n          try {\n            for (clientList_1 = __values(clientList), clientList_1_1 = clientList_1.next(); !clientList_1_1.done; clientList_1_1 = clientList_1.next()) {\n              client = clientList_1_1.value;\n              clientUrl = new URL(client.url, self.location.href);\n\n              if (url.host === clientUrl.host) {\n                return [2\n                /*return*/\n                , client];\n              }\n            }\n          } catch (e_1_1) {\n            e_1 = {\n              error: e_1_1\n            };\n          } finally {\n            try {\n              if (clientList_1_1 && !clientList_1_1.done && (_a = clientList_1.return)) _a.call(clientList_1);\n            } finally {\n              if (e_1) throw e_1.error;\n            }\n          }\n\n          return [2\n          /*return*/\n          , null];\n      }\n    });\n  });\n}\n/**\r\n * @returns If there is currently a visible WindowClient, this method will resolve to true,\r\n * otherwise false.\r\n */\n\n\nfunction hasVisibleClients(clientList) {\n  return clientList.some(function (client) {\n    return client.visibilityState === 'visible' && // Ignore chrome-extension clients as that matches the background pages of extensions, which\n    // are always considered visible for some reason.\n    !client.url.startsWith('chrome-extension://');\n  });\n}\n\nfunction sendMessagePayloadInternalToWindows(clientList, internalPayload) {\n  var e_2, _a;\n\n  internalPayload.isFirebaseMessaging = true;\n  internalPayload.messageType = MessageType.PUSH_RECEIVED;\n\n  try {\n    for (var clientList_2 = __values(clientList), clientList_2_1 = clientList_2.next(); !clientList_2_1.done; clientList_2_1 = clientList_2.next()) {\n      var client = clientList_2_1.value;\n      client.postMessage(internalPayload);\n    }\n  } catch (e_2_1) {\n    e_2 = {\n      error: e_2_1\n    };\n  } finally {\n    try {\n      if (clientList_2_1 && !clientList_2_1.done && (_a = clientList_2.return)) _a.call(clientList_2);\n    } finally {\n      if (e_2) throw e_2.error;\n    }\n  }\n}\n\nfunction getClientList() {\n  return self.clients.matchAll({\n    type: 'window',\n    includeUncontrolled: true // TS doesn't know that \"type: 'window'\" means it'll return WindowClient[]\n\n  });\n}\n\nfunction showNotification(notificationPayloadInternal) {\n  var _a; // Note: Firefox does not support the maxActions property.\n  // https://developer.mozilla.org/en-US/docs/Web/API/notification/maxActions\n\n\n  var actions = notificationPayloadInternal.actions;\n  var maxActions = Notification.maxActions;\n\n  if (actions && maxActions && actions.length > maxActions) {\n    console.warn(\"This browser only supports \" + maxActions + \" actions. The remaining actions will not be displayed.\");\n  }\n\n  return self.registration.showNotification((_a =\n  /* title= */\n  notificationPayloadInternal.title) !== null && _a !== void 0 ? _a : '', notificationPayloadInternal);\n}\n\nfunction getLink(payload) {\n  var _a, _b, _c; // eslint-disable-next-line camelcase\n\n\n  var link = (_b = (_a = payload.fcmOptions) === null || _a === void 0 ? void 0 : _a.link) !== null && _b !== void 0 ? _b : (_c = payload.notification) === null || _c === void 0 ? void 0 : _c.click_action;\n\n  if (link) {\n    return link;\n  }\n\n  if (isConsoleMessage(payload.data)) {\n    // Notification created in the Firebase Console. Redirect to origin.\n    return self.location.origin;\n  } else {\n    return null;\n  }\n}\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar WindowController =\n/** @class */\nfunction () {\n  function WindowController(firebaseDependencies) {\n    var _this = this;\n\n    this.firebaseDependencies = firebaseDependencies;\n    this.vapidKey = null;\n    this.onMessageCallback = null;\n    navigator.serviceWorker.addEventListener('message', function (e) {\n      return _this.messageEventListener(e);\n    });\n  }\n\n  Object.defineProperty(WindowController.prototype, \"app\", {\n    get: function () {\n      return this.firebaseDependencies.app;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  WindowController.prototype.messageEventListener = function (event) {\n    return __awaiter(this, void 0, void 0, function () {\n      var internalPayload, dataPayload;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            internalPayload = event.data;\n\n            if (!internalPayload.isFirebaseMessaging) {\n              return [2\n              /*return*/\n              ];\n            } // onMessageCallback is either a function or observer/subscriber.\n            // TODO: in the modularization release, have onMessage handle type MessagePayload as supposed to\n            // the legacy payload where some fields are in snake cases.\n\n\n            if (this.onMessageCallback && internalPayload.messageType === MessageType.PUSH_RECEIVED) {\n              if (typeof this.onMessageCallback === 'function') {\n                this.onMessageCallback(stripInternalFields(Object.assign({}, internalPayload)));\n              } else {\n                this.onMessageCallback.next(Object.assign({}, internalPayload));\n              }\n            }\n\n            dataPayload = internalPayload.data;\n            if (!(isConsoleMessage(dataPayload) && dataPayload[CONSOLE_CAMPAIGN_ANALYTICS_ENABLED] === '1')) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , this.logEvent(internalPayload.messageType, dataPayload)];\n\n          case 1:\n            _a.sent();\n\n            _a.label = 2;\n\n          case 2:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  WindowController.prototype.getVapidKey = function () {\n    return this.vapidKey;\n  };\n\n  WindowController.prototype.getSwReg = function () {\n    return this.swRegistration;\n  };\n\n  WindowController.prototype.getToken = function (options) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!(Notification.permission === 'default')) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , Notification.requestPermission()];\n\n          case 1:\n            _a.sent();\n\n            _a.label = 2;\n\n          case 2:\n            if (Notification.permission !== 'granted') {\n              throw ERROR_FACTORY.create(\"permission-blocked\"\n              /* PERMISSION_BLOCKED */\n              );\n            }\n\n            return [4\n            /*yield*/\n            , this.updateVapidKey(options === null || options === void 0 ? void 0 : options.vapidKey)];\n\n          case 3:\n            _a.sent();\n\n            return [4\n            /*yield*/\n            , this.updateSwReg(options === null || options === void 0 ? void 0 : options.serviceWorkerRegistration)];\n\n          case 4:\n            _a.sent();\n\n            return [2\n            /*return*/\n            , getToken(this.firebaseDependencies, this.swRegistration, this.vapidKey)];\n        }\n      });\n    });\n  };\n\n  WindowController.prototype.updateVapidKey = function (vapidKey) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        if (!!vapidKey) {\n          this.vapidKey = vapidKey;\n        } else if (!this.vapidKey) {\n          this.vapidKey = DEFAULT_VAPID_KEY;\n        }\n\n        return [2\n        /*return*/\n        ];\n      });\n    });\n  };\n\n  WindowController.prototype.updateSwReg = function (swRegistration) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!(!swRegistration && !this.swRegistration)) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , this.registerDefaultSw()];\n\n          case 1:\n            _a.sent();\n\n            _a.label = 2;\n\n          case 2:\n            if (!swRegistration && !!this.swRegistration) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            if (!(swRegistration instanceof ServiceWorkerRegistration)) {\n              throw ERROR_FACTORY.create(\"invalid-sw-registration\"\n              /* INVALID_SW_REGISTRATION */\n              );\n            }\n\n            this.swRegistration = swRegistration;\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  WindowController.prototype.registerDefaultSw = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, e_1;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            _b.trys.push([0, 2,, 3]);\n\n            _a = this;\n            return [4\n            /*yield*/\n            , navigator.serviceWorker.register(DEFAULT_SW_PATH, {\n              scope: DEFAULT_SW_SCOPE\n            })];\n\n          case 1:\n            _a.swRegistration = _b.sent(); // The timing when browser updates sw when sw has an update is unreliable by my experiment. It\n            // leads to version conflict when the SDK upgrades to a newer version in the main page, but sw\n            // is stuck with the old version. For example,\n            // https://github.com/firebase/firebase-js-sdk/issues/2590 The following line reliably updates\n            // sw if there was an update.\n\n            this.swRegistration.update().catch(function () {\n              /* it is non blocking and we don't care if it failed */\n            });\n            return [3\n            /*break*/\n            , 3];\n\n          case 2:\n            e_1 = _b.sent();\n            throw ERROR_FACTORY.create(\"failed-service-worker-registration\"\n            /* FAILED_DEFAULT_REGISTRATION */\n            , {\n              browserErrorMessage: e_1.message\n            });\n\n          case 3:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  WindowController.prototype.deleteToken = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!!this.swRegistration) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , this.registerDefaultSw()];\n\n          case 1:\n            _a.sent();\n\n            _a.label = 2;\n\n          case 2:\n            return [2\n            /*return*/\n            , deleteToken(this.firebaseDependencies, this.swRegistration)];\n        }\n      });\n    });\n  };\n  /**\r\n   * Request permission if it is not currently granted.\r\n   *\r\n   * @return Resolves if the permission was granted, rejects otherwise.\r\n   *\r\n   * @deprecated Use Notification.requestPermission() instead.\r\n   * https://developer.mozilla.org/en-US/docs/Web/API/Notification/requestPermission\r\n   */\n\n\n  WindowController.prototype.requestPermission = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var permissionResult;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (Notification.permission === 'granted') {\n              return [2\n              /*return*/\n              ];\n            }\n\n            return [4\n            /*yield*/\n            , Notification.requestPermission()];\n\n          case 1:\n            permissionResult = _a.sent();\n\n            if (permissionResult === 'granted') {\n              return [2\n              /*return*/\n              ];\n            } else if (permissionResult === 'denied') {\n              throw ERROR_FACTORY.create(\"permission-blocked\"\n              /* PERMISSION_BLOCKED */\n              );\n            } else {\n              throw ERROR_FACTORY.create(\"permission-default\"\n              /* PERMISSION_DEFAULT */\n              );\n            }\n\n        }\n      });\n    });\n  };\n  /**\r\n   * @deprecated. Use getToken(options?: {vapidKey?: string; serviceWorkerRegistration?:\r\n   * ServiceWorkerRegistration;}): Promise<string> instead.\r\n   */\n\n\n  WindowController.prototype.usePublicVapidKey = function (vapidKey) {\n    if (this.vapidKey !== null) {\n      throw ERROR_FACTORY.create(\"use-vapid-key-after-get-token\"\n      /* USE_VAPID_KEY_AFTER_GET_TOKEN */\n      );\n    }\n\n    if (typeof vapidKey !== 'string' || vapidKey.length === 0) {\n      throw ERROR_FACTORY.create(\"invalid-vapid-key\"\n      /* INVALID_VAPID_KEY */\n      );\n    }\n\n    this.vapidKey = vapidKey;\n  };\n  /**\r\n   * @deprecated. Use getToken(options?: {vapidKey?: string; serviceWorkerRegistration?:\r\n   * ServiceWorkerRegistration;}): Promise<string> instead.\r\n   */\n\n\n  WindowController.prototype.useServiceWorker = function (swRegistration) {\n    if (!(swRegistration instanceof ServiceWorkerRegistration)) {\n      throw ERROR_FACTORY.create(\"invalid-sw-registration\"\n      /* INVALID_SW_REGISTRATION */\n      );\n    }\n\n    if (this.swRegistration) {\n      throw ERROR_FACTORY.create(\"use-sw-after-get-token\"\n      /* USE_SW_AFTER_GET_TOKEN */\n      );\n    }\n\n    this.swRegistration = swRegistration;\n  };\n  /**\r\n   * @param nextOrObserver An observer object or a function triggered on message.\r\n   *\r\n   * @return The unsubscribe function for the observer.\r\n   */\n\n\n  WindowController.prototype.onMessage = function (nextOrObserver) {\n    var _this = this;\n\n    this.onMessageCallback = nextOrObserver;\n    return function () {\n      _this.onMessageCallback = null;\n    };\n  };\n\n  WindowController.prototype.setBackgroundMessageHandler = function () {\n    throw ERROR_FACTORY.create(\"only-available-in-sw\"\n    /* AVAILABLE_IN_SW */\n    );\n  };\n\n  WindowController.prototype.onBackgroundMessage = function () {\n    throw ERROR_FACTORY.create(\"only-available-in-sw\"\n    /* AVAILABLE_IN_SW */\n    );\n  };\n  /**\r\n   * @deprecated No-op. It was initially designed with token rotation requests from server in mind.\r\n   * However, the plan to implement such feature was abandoned.\r\n   */\n\n\n  WindowController.prototype.onTokenRefresh = function () {\n    return function () {};\n  };\n\n  WindowController.prototype.logEvent = function (messageType, data) {\n    return __awaiter(this, void 0, void 0, function () {\n      var eventType, analytics;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            eventType = getEventType(messageType);\n            return [4\n            /*yield*/\n            , this.firebaseDependencies.analyticsProvider.get()];\n\n          case 1:\n            analytics = _a.sent();\n            analytics.logEvent(eventType, {\n              /* eslint-disable camelcase */\n              message_id: data[CONSOLE_CAMPAIGN_ID],\n              message_name: data[CONSOLE_CAMPAIGN_NAME],\n              message_time: data[CONSOLE_CAMPAIGN_TIME],\n              message_device_time: Math.floor(Date.now() / 1000)\n              /* eslint-enable camelcase */\n\n            });\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  return WindowController;\n}();\n\nfunction getEventType(messageType) {\n  switch (messageType) {\n    case MessageType.NOTIFICATION_CLICKED:\n      return 'notification_open';\n\n    case MessageType.PUSH_RECEIVED:\n      return 'notification_foreground';\n\n    default:\n      throw new Error();\n  }\n}\n\nfunction stripInternalFields(internalPayload) {\n  delete internalPayload.messageType;\n  delete internalPayload.isFirebaseMessaging;\n  return internalPayload;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction extractAppConfig(app) {\n  var e_1, _a;\n\n  if (!app || !app.options) {\n    throw getMissingValueError('App Configuration Object');\n  }\n\n  if (!app.name) {\n    throw getMissingValueError('App Name');\n  } // Required app config keys\n\n\n  var configKeys = ['projectId', 'apiKey', 'appId', 'messagingSenderId'];\n  var options = app.options;\n\n  try {\n    for (var configKeys_1 = __values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\n      var keyName = configKeys_1_1.value;\n\n      if (!options[keyName]) {\n        throw getMissingValueError(keyName);\n      }\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  return {\n    appName: app.name,\n    projectId: options.projectId,\n    apiKey: options.apiKey,\n    appId: options.appId,\n    senderId: options.messagingSenderId\n  };\n}\n\nfunction getMissingValueError(valueName) {\n  return ERROR_FACTORY.create(\"missing-app-config-values\"\n  /* MISSING_APP_CONFIG_VALUES */\n  , {\n    valueName: valueName\n  });\n}\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar MESSAGING_NAME = 'messaging';\n\nfunction factoryMethod(container) {\n  // Dependencies.\n  var app = container.getProvider('app').getImmediate();\n  var appConfig = extractAppConfig(app);\n  var installations = container.getProvider('installations').getImmediate();\n  var analyticsProvider = container.getProvider('analytics-internal');\n  var firebaseDependencies = {\n    app: app,\n    appConfig: appConfig,\n    installations: installations,\n    analyticsProvider: analyticsProvider\n  };\n\n  if (!isSupported()) {\n    throw ERROR_FACTORY.create(\"unsupported-browser\"\n    /* UNSUPPORTED_BROWSER */\n    );\n  }\n\n  if (self && 'ServiceWorkerGlobalScope' in self) {\n    // Running in ServiceWorker context\n    return new SwController(firebaseDependencies);\n  } else {\n    // Assume we are in the window context.\n    return new WindowController(firebaseDependencies);\n  }\n}\n\nvar NAMESPACE_EXPORTS = {\n  isSupported: isSupported\n};\nfirebase.INTERNAL.registerComponent(new Component(MESSAGING_NAME, factoryMethod, \"PUBLIC\"\n/* PUBLIC */\n).setServiceProps(NAMESPACE_EXPORTS));\n\nfunction isSupported() {\n  if (self && 'ServiceWorkerGlobalScope' in self) {\n    // Running in ServiceWorker context\n    return isSWControllerSupported();\n  } else {\n    // Assume we are in the window context.\n    return isWindowControllerSupported();\n  }\n}\n/**\r\n * Checks to see if the required APIs exist.\r\n */\n\n\nfunction isWindowControllerSupported() {\n  return 'indexedDB' in window && indexedDB !== null && navigator.cookieEnabled && 'serviceWorker' in navigator && 'PushManager' in window && 'Notification' in window && 'fetch' in window && ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') && PushSubscription.prototype.hasOwnProperty('getKey');\n}\n/**\r\n * Checks to see if the required APIs exist within SW Context.\r\n */\n\n\nfunction isSWControllerSupported() {\n  return 'indexedDB' in self && indexedDB !== null && 'PushManager' in self && 'Notification' in self && ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') && PushSubscription.prototype.hasOwnProperty('getKey');\n}","map":{"version":3,"names":["Component","ErrorFactory","__spread","__awaiter","__generator","__assign","__values","deleteDb","openDb","firebase","_a","ERROR_MAP","ERROR_FACTORY","DEFAULT_SW_PATH","DEFAULT_SW_SCOPE","DEFAULT_VAPID_KEY","ENDPOINT","FCM_MSG","CONSOLE_CAMPAIGN_ID","CONSOLE_CAMPAIGN_NAME","CONSOLE_CAMPAIGN_TIME","CONSOLE_CAMPAIGN_ANALYTICS_ENABLED","TAG","MessageType","arrayToBase64","array","uint8Array","Uint8Array","base64String","btoa","String","fromCharCode","apply","replace","base64ToArray","padding","repeat","length","base64","rawData","atob","outputArray","i","charCodeAt","OLD_DB_NAME","OLD_DB_VERSION","OLD_OBJECT_STORE_NAME","migrateOldDatabase","senderId","databases","dbNames","tokenDetails","db","_this","label","indexedDB","sent","map","name","includes","objectStore","value","oldDetails","_b","oldVersion","objectStoreNames","contains","transaction","index","get","clear","auth","p256dh","endpoint","token","fcmToken","createTime","Date","now","subscriptionOptions","swScope","vapidKey","close","checkTokenDetails","DATABASE_NAME","DATABASE_VERSION","OBJECT_STORE_NAME","dbPromise","getDbPromise","upgradeDb","createObjectStore","dbGet","firebaseDependencies","key","oldTokenDetails","getKey","appConfig","dbSet","tx","put","complete","dbRemove","delete","appId","requestGetToken","headers","body","subscribeOptions","responseData","response","err_1","message","getHeaders","getBody","method","JSON","stringify","trys","push","fetch","getEndpoint","json","create","errorInfo","error","requestUpdateToken","updateOptions","err_2","requestDeleteToken","unsubscribeOptions","err_3","projectId","installations","authToken","getToken","Headers","Accept","apiKey","web","applicationPubKey","TOKEN_EXPIRATION_MS","swRegistration","pushSubscription","e_1","Notification","permission","getPushSubscription","scope","getNewToken","isTokenValid","console","warn","updateToken","deleteToken","pushManager","getSubscription","unsubscribe","updatedToken","updatedTokenDetails","e_2","subscription","subscribe","userVisibleOnly","applicationServerKey","dbOptions","currentOptions","isVapidKeyEqual","isEndpointEqual","isAuthEqual","isP256dhEqual","externalizePayload","internalPayload","payload","from","collapseKey","collapse_key","propagateNotificationPayload","propagateDataPayload","propagateFcmOptions","messagePayloadInternal","notification","title","image","data","fcmOptions","link","analyticsLabel","analytics_label","isConsoleMessage","sleep","ms","Promise","resolve","setTimeout","SwController","isOnBackgroundMessageUsed","bgMessageHandler","self","addEventListener","e","waitUntil","onPush","onSubChange","onNotificationClick","Object","defineProperty","prototype","app","enumerable","configurable","setBackgroundMessageHandler","callback","onBackgroundMessage","nextOrObserver","_c","registration","requestPermission","usePublicVapidKey","useServiceWorker","onMessage","onTokenRefresh","event","clientList","isNotificationShown","getMessagePayloadInternal","debug","getClientList","hasVisibleClients","sendMessagePayloadInternalToWindows","showNotification","wrapInternalPayload","next","newSubscription","url","originUrl","client","action","stopImmediatePropagation","getLink","URL","location","href","origin","host","getWindowClient","clients","openWindow","focus","messageType","NOTIFICATION_CLICKED","isFirebaseMessaging","postMessage","wrappedInternalPayload","err","clientList_1","clientList_1_1","clientUrl","done","e_1_1","return","call","some","visibilityState","startsWith","PUSH_RECEIVED","clientList_2","clientList_2_1","e_2_1","matchAll","type","includeUncontrolled","notificationPayloadInternal","actions","maxActions","click_action","WindowController","onMessageCallback","navigator","serviceWorker","messageEventListener","dataPayload","stripInternalFields","assign","logEvent","getVapidKey","getSwReg","options","updateVapidKey","updateSwReg","serviceWorkerRegistration","registerDefaultSw","ServiceWorkerRegistration","register","update","catch","browserErrorMessage","permissionResult","eventType","analytics","getEventType","analyticsProvider","message_id","message_name","message_time","message_device_time","Math","floor","Error","extractAppConfig","getMissingValueError","configKeys","configKeys_1","configKeys_1_1","keyName","appName","messagingSenderId","valueName","MESSAGING_NAME","factoryMethod","container","getProvider","getImmediate","isSupported","NAMESPACE_EXPORTS","INTERNAL","registerComponent","setServiceProps","isSWControllerSupported","isWindowControllerSupported","window","cookieEnabled","hasOwnProperty","PushSubscription"],"sources":["/Users/usman/Documents/GitHub/Fasana-e-Dil-Blog/node_modules/@firebase/messaging/dist/index.esm.js"],"sourcesContent":["import '@firebase/installations';\nimport { Component } from '@firebase/component';\nimport { ErrorFactory } from '@firebase/util';\nimport { __spread, __awaiter, __generator, __assign, __values } from 'tslib';\nimport { deleteDb, openDb } from 'idb';\nimport firebase from '@firebase/app';\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\nvar ERROR_MAP = (_a = {},\r\n    _a[\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */] = 'Missing App configuration value: \"{$valueName}\"',\r\n    _a[\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */] = 'This method is available in a Window context.',\r\n    _a[\"only-available-in-sw\" /* AVAILABLE_IN_SW */] = 'This method is available in a service worker context.',\r\n    _a[\"permission-default\" /* PERMISSION_DEFAULT */] = 'The notification permission was not granted and dismissed instead.',\r\n    _a[\"permission-blocked\" /* PERMISSION_BLOCKED */] = 'The notification permission was not granted and blocked instead.',\r\n    _a[\"unsupported-browser\" /* UNSUPPORTED_BROWSER */] = \"This browser doesn't support the API's required to use the firebase SDK.\",\r\n    _a[\"failed-service-worker-registration\" /* FAILED_DEFAULT_REGISTRATION */] = 'We are unable to register the default service worker. {$browserErrorMessage}',\r\n    _a[\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */] = 'A problem occurred while subscribing the user to FCM: {$errorInfo}',\r\n    _a[\"token-subscribe-no-token\" /* TOKEN_SUBSCRIBE_NO_TOKEN */] = 'FCM returned no token when subscribing the user to push.',\r\n    _a[\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */] = 'A problem occurred while unsubscribing the ' +\r\n        'user from FCM: {$errorInfo}',\r\n    _a[\"token-update-failed\" /* TOKEN_UPDATE_FAILED */] = 'A problem occurred while updating the user from FCM: {$errorInfo}',\r\n    _a[\"token-update-no-token\" /* TOKEN_UPDATE_NO_TOKEN */] = 'FCM returned no token when updating the user to push.',\r\n    _a[\"use-sw-after-get-token\" /* USE_SW_AFTER_GET_TOKEN */] = 'The useServiceWorker() method may only be called once and must be ' +\r\n        'called before calling getToken() to ensure your service worker is used.',\r\n    _a[\"invalid-sw-registration\" /* INVALID_SW_REGISTRATION */] = 'The input to useServiceWorker() must be a ServiceWorkerRegistration.',\r\n    _a[\"invalid-bg-handler\" /* INVALID_BG_HANDLER */] = 'The input to setBackgroundMessageHandler() must be a function.',\r\n    _a[\"invalid-vapid-key\" /* INVALID_VAPID_KEY */] = 'The public VAPID key must be a string.',\r\n    _a[\"use-vapid-key-after-get-token\" /* USE_VAPID_KEY_AFTER_GET_TOKEN */] = 'The usePublicVapidKey() method may only be called once and must be ' +\r\n        'called before calling getToken() to ensure your VAPID key is used.',\r\n    _a);\r\nvar ERROR_FACTORY = new ErrorFactory('messaging', 'Messaging', ERROR_MAP);\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DEFAULT_SW_PATH = '/firebase-messaging-sw.js';\r\nvar DEFAULT_SW_SCOPE = '/firebase-cloud-messaging-push-scope';\r\nvar DEFAULT_VAPID_KEY = 'BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4';\r\nvar ENDPOINT = 'https://fcmregistrations.googleapis.com/v1';\r\n/** Key of FCM Payload in Notification's data field. */\r\nvar FCM_MSG = 'FCM_MSG';\r\nvar CONSOLE_CAMPAIGN_ID = 'google.c.a.c_id';\r\nvar CONSOLE_CAMPAIGN_NAME = 'google.c.a.c_l';\r\nvar CONSOLE_CAMPAIGN_TIME = 'google.c.a.ts';\r\n/** Set to '1' if Analytics is enabled for the campaign */\r\nvar CONSOLE_CAMPAIGN_ANALYTICS_ENABLED = 'google.c.a.e';\r\nvar TAG = 'FirebaseMessaging: ';\n\n/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\r\n * in compliance with the License. You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software distributed under the License\r\n * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\r\n * or implied. See the License for the specific language governing permissions and limitations under\r\n * the License.\r\n */\r\nvar MessageType;\r\n(function (MessageType) {\r\n    MessageType[\"PUSH_RECEIVED\"] = \"push-received\";\r\n    MessageType[\"NOTIFICATION_CLICKED\"] = \"notification-clicked\";\r\n})(MessageType || (MessageType = {}));\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction arrayToBase64(array) {\r\n    var uint8Array = new Uint8Array(array);\r\n    var base64String = btoa(String.fromCharCode.apply(String, __spread(uint8Array)));\r\n    return base64String.replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\r\n}\r\nfunction base64ToArray(base64String) {\r\n    var padding = '='.repeat((4 - (base64String.length % 4)) % 4);\r\n    var base64 = (base64String + padding)\r\n        .replace(/\\-/g, '+')\r\n        .replace(/_/g, '/');\r\n    var rawData = atob(base64);\r\n    var outputArray = new Uint8Array(rawData.length);\r\n    for (var i = 0; i < rawData.length; ++i) {\r\n        outputArray[i] = rawData.charCodeAt(i);\r\n    }\r\n    return outputArray;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar OLD_DB_NAME = 'fcm_token_details_db';\r\n/**\r\n * The last DB version of 'fcm_token_details_db' was 4. This is one higher, so that the upgrade\r\n * callback is called for all versions of the old DB.\r\n */\r\nvar OLD_DB_VERSION = 5;\r\nvar OLD_OBJECT_STORE_NAME = 'fcm_token_object_Store';\r\nfunction migrateOldDatabase(senderId) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var databases, dbNames, tokenDetails, db;\r\n        var _this = this;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (!('databases' in indexedDB)) return [3 /*break*/, 2];\r\n                    return [4 /*yield*/, indexedDB.databases()];\r\n                case 1:\r\n                    databases = _a.sent();\r\n                    dbNames = databases.map(function (db) { return db.name; });\r\n                    if (!dbNames.includes(OLD_DB_NAME)) {\r\n                        // old DB didn't exist, no need to open.\r\n                        return [2 /*return*/, null];\r\n                    }\r\n                    _a.label = 2;\r\n                case 2:\r\n                    tokenDetails = null;\r\n                    return [4 /*yield*/, openDb(OLD_DB_NAME, OLD_DB_VERSION, function (db) { return __awaiter(_this, void 0, void 0, function () {\r\n                            var objectStore, value, oldDetails, oldDetails, oldDetails;\r\n                            var _a;\r\n                            return __generator(this, function (_b) {\r\n                                switch (_b.label) {\r\n                                    case 0:\r\n                                        if (db.oldVersion < 2) {\r\n                                            // Database too old, skip migration.\r\n                                            return [2 /*return*/];\r\n                                        }\r\n                                        if (!db.objectStoreNames.contains(OLD_OBJECT_STORE_NAME)) {\r\n                                            // Database did not exist. Nothing to do.\r\n                                            return [2 /*return*/];\r\n                                        }\r\n                                        objectStore = db.transaction.objectStore(OLD_OBJECT_STORE_NAME);\r\n                                        return [4 /*yield*/, objectStore.index('fcmSenderId').get(senderId)];\r\n                                    case 1:\r\n                                        value = _b.sent();\r\n                                        return [4 /*yield*/, objectStore.clear()];\r\n                                    case 2:\r\n                                        _b.sent();\r\n                                        if (!value) {\r\n                                            // No entry in the database, nothing to migrate.\r\n                                            return [2 /*return*/];\r\n                                        }\r\n                                        if (db.oldVersion === 2) {\r\n                                            oldDetails = value;\r\n                                            if (!oldDetails.auth || !oldDetails.p256dh || !oldDetails.endpoint) {\r\n                                                return [2 /*return*/];\r\n                                            }\r\n                                            tokenDetails = {\r\n                                                token: oldDetails.fcmToken,\r\n                                                createTime: (_a = oldDetails.createTime) !== null && _a !== void 0 ? _a : Date.now(),\r\n                                                subscriptionOptions: {\r\n                                                    auth: oldDetails.auth,\r\n                                                    p256dh: oldDetails.p256dh,\r\n                                                    endpoint: oldDetails.endpoint,\r\n                                                    swScope: oldDetails.swScope,\r\n                                                    vapidKey: typeof oldDetails.vapidKey === 'string'\r\n                                                        ? oldDetails.vapidKey\r\n                                                        : arrayToBase64(oldDetails.vapidKey)\r\n                                                }\r\n                                            };\r\n                                        }\r\n                                        else if (db.oldVersion === 3) {\r\n                                            oldDetails = value;\r\n                                            tokenDetails = {\r\n                                                token: oldDetails.fcmToken,\r\n                                                createTime: oldDetails.createTime,\r\n                                                subscriptionOptions: {\r\n                                                    auth: arrayToBase64(oldDetails.auth),\r\n                                                    p256dh: arrayToBase64(oldDetails.p256dh),\r\n                                                    endpoint: oldDetails.endpoint,\r\n                                                    swScope: oldDetails.swScope,\r\n                                                    vapidKey: arrayToBase64(oldDetails.vapidKey)\r\n                                                }\r\n                                            };\r\n                                        }\r\n                                        else if (db.oldVersion === 4) {\r\n                                            oldDetails = value;\r\n                                            tokenDetails = {\r\n                                                token: oldDetails.fcmToken,\r\n                                                createTime: oldDetails.createTime,\r\n                                                subscriptionOptions: {\r\n                                                    auth: arrayToBase64(oldDetails.auth),\r\n                                                    p256dh: arrayToBase64(oldDetails.p256dh),\r\n                                                    endpoint: oldDetails.endpoint,\r\n                                                    swScope: oldDetails.swScope,\r\n                                                    vapidKey: arrayToBase64(oldDetails.vapidKey)\r\n                                                }\r\n                                            };\r\n                                        }\r\n                                        return [2 /*return*/];\r\n                                }\r\n                            });\r\n                        }); })];\r\n                case 3:\r\n                    db = _a.sent();\r\n                    db.close();\r\n                    // Delete all old databases.\r\n                    return [4 /*yield*/, deleteDb(OLD_DB_NAME)];\r\n                case 4:\r\n                    // Delete all old databases.\r\n                    _a.sent();\r\n                    return [4 /*yield*/, deleteDb('fcm_vapid_details_db')];\r\n                case 5:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, deleteDb('undefined')];\r\n                case 6:\r\n                    _a.sent();\r\n                    return [2 /*return*/, checkTokenDetails(tokenDetails) ? tokenDetails : null];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction checkTokenDetails(tokenDetails) {\r\n    if (!tokenDetails || !tokenDetails.subscriptionOptions) {\r\n        return false;\r\n    }\r\n    var subscriptionOptions = tokenDetails.subscriptionOptions;\r\n    return (typeof tokenDetails.createTime === 'number' &&\r\n        tokenDetails.createTime > 0 &&\r\n        typeof tokenDetails.token === 'string' &&\r\n        tokenDetails.token.length > 0 &&\r\n        typeof subscriptionOptions.auth === 'string' &&\r\n        subscriptionOptions.auth.length > 0 &&\r\n        typeof subscriptionOptions.p256dh === 'string' &&\r\n        subscriptionOptions.p256dh.length > 0 &&\r\n        typeof subscriptionOptions.endpoint === 'string' &&\r\n        subscriptionOptions.endpoint.length > 0 &&\r\n        typeof subscriptionOptions.swScope === 'string' &&\r\n        subscriptionOptions.swScope.length > 0 &&\r\n        typeof subscriptionOptions.vapidKey === 'string' &&\r\n        subscriptionOptions.vapidKey.length > 0);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Exported for tests.\r\nvar DATABASE_NAME = 'firebase-messaging-database';\r\nvar DATABASE_VERSION = 1;\r\nvar OBJECT_STORE_NAME = 'firebase-messaging-store';\r\nvar dbPromise = null;\r\nfunction getDbPromise() {\r\n    if (!dbPromise) {\r\n        dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDb) {\r\n            // We don't use 'break' in this switch statement, the fall-through behavior is what we want,\r\n            // because if there are multiple versions between the old version and the current version, we\r\n            // want ALL the migrations that correspond to those versions to run, not only the last one.\r\n            // eslint-disable-next-line default-case\r\n            switch (upgradeDb.oldVersion) {\r\n                case 0:\r\n                    upgradeDb.createObjectStore(OBJECT_STORE_NAME);\r\n            }\r\n        });\r\n    }\r\n    return dbPromise;\r\n}\r\n/** Gets record(s) from the objectStore that match the given key. */\r\nfunction dbGet(firebaseDependencies) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tokenDetails, oldTokenDetails;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(firebaseDependencies);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    return [4 /*yield*/, db\r\n                            .transaction(OBJECT_STORE_NAME)\r\n                            .objectStore(OBJECT_STORE_NAME)\r\n                            .get(key)];\r\n                case 2:\r\n                    tokenDetails = _a.sent();\r\n                    if (!tokenDetails) return [3 /*break*/, 3];\r\n                    return [2 /*return*/, tokenDetails];\r\n                case 3: return [4 /*yield*/, migrateOldDatabase(firebaseDependencies.appConfig.senderId)];\r\n                case 4:\r\n                    oldTokenDetails = _a.sent();\r\n                    if (!oldTokenDetails) return [3 /*break*/, 6];\r\n                    return [4 /*yield*/, dbSet(firebaseDependencies, oldTokenDetails)];\r\n                case 5:\r\n                    _a.sent();\r\n                    return [2 /*return*/, oldTokenDetails];\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Assigns or overwrites the record for the given key with the given value. */\r\nfunction dbSet(firebaseDependencies, tokenDetails) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(firebaseDependencies);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).put(tokenDetails, key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/, tokenDetails];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Removes record(s) from the objectStore that match the given key. */\r\nfunction dbRemove(firebaseDependencies) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(firebaseDependencies);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).delete(key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getKey(_a) {\r\n    var appConfig = _a.appConfig;\r\n    return appConfig.appId;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction requestGetToken(firebaseDependencies, subscriptionOptions) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var headers, body, subscribeOptions, responseData, response, err_1, message;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getHeaders(firebaseDependencies)];\r\n                case 1:\r\n                    headers = _a.sent();\r\n                    body = getBody(subscriptionOptions);\r\n                    subscribeOptions = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    _a.label = 2;\r\n                case 2:\r\n                    _a.trys.push([2, 5, , 6]);\r\n                    return [4 /*yield*/, fetch(getEndpoint(firebaseDependencies.appConfig), subscribeOptions)];\r\n                case 3:\r\n                    response = _a.sent();\r\n                    return [4 /*yield*/, response.json()];\r\n                case 4:\r\n                    responseData = _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 5:\r\n                    err_1 = _a.sent();\r\n                    throw ERROR_FACTORY.create(\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */, {\r\n                        errorInfo: err_1\r\n                    });\r\n                case 6:\r\n                    if (responseData.error) {\r\n                        message = responseData.error.message;\r\n                        throw ERROR_FACTORY.create(\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */, {\r\n                            errorInfo: message\r\n                        });\r\n                    }\r\n                    if (!responseData.token) {\r\n                        throw ERROR_FACTORY.create(\"token-subscribe-no-token\" /* TOKEN_SUBSCRIBE_NO_TOKEN */);\r\n                    }\r\n                    return [2 /*return*/, responseData.token];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction requestUpdateToken(firebaseDependencies, tokenDetails) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var headers, body, updateOptions, responseData, response, err_2, message;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getHeaders(firebaseDependencies)];\r\n                case 1:\r\n                    headers = _a.sent();\r\n                    body = getBody(tokenDetails.subscriptionOptions);\r\n                    updateOptions = {\r\n                        method: 'PATCH',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    _a.label = 2;\r\n                case 2:\r\n                    _a.trys.push([2, 5, , 6]);\r\n                    return [4 /*yield*/, fetch(getEndpoint(firebaseDependencies.appConfig) + \"/\" + tokenDetails.token, updateOptions)];\r\n                case 3:\r\n                    response = _a.sent();\r\n                    return [4 /*yield*/, response.json()];\r\n                case 4:\r\n                    responseData = _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 5:\r\n                    err_2 = _a.sent();\r\n                    throw ERROR_FACTORY.create(\"token-update-failed\" /* TOKEN_UPDATE_FAILED */, {\r\n                        errorInfo: err_2\r\n                    });\r\n                case 6:\r\n                    if (responseData.error) {\r\n                        message = responseData.error.message;\r\n                        throw ERROR_FACTORY.create(\"token-update-failed\" /* TOKEN_UPDATE_FAILED */, {\r\n                            errorInfo: message\r\n                        });\r\n                    }\r\n                    if (!responseData.token) {\r\n                        throw ERROR_FACTORY.create(\"token-update-no-token\" /* TOKEN_UPDATE_NO_TOKEN */);\r\n                    }\r\n                    return [2 /*return*/, responseData.token];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction requestDeleteToken(firebaseDependencies, token) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var headers, unsubscribeOptions, response, responseData, message, err_3;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getHeaders(firebaseDependencies)];\r\n                case 1:\r\n                    headers = _a.sent();\r\n                    unsubscribeOptions = {\r\n                        method: 'DELETE',\r\n                        headers: headers\r\n                    };\r\n                    _a.label = 2;\r\n                case 2:\r\n                    _a.trys.push([2, 5, , 6]);\r\n                    return [4 /*yield*/, fetch(getEndpoint(firebaseDependencies.appConfig) + \"/\" + token, unsubscribeOptions)];\r\n                case 3:\r\n                    response = _a.sent();\r\n                    return [4 /*yield*/, response.json()];\r\n                case 4:\r\n                    responseData = _a.sent();\r\n                    if (responseData.error) {\r\n                        message = responseData.error.message;\r\n                        throw ERROR_FACTORY.create(\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */, {\r\n                            errorInfo: message\r\n                        });\r\n                    }\r\n                    return [3 /*break*/, 6];\r\n                case 5:\r\n                    err_3 = _a.sent();\r\n                    throw ERROR_FACTORY.create(\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */, {\r\n                        errorInfo: err_3\r\n                    });\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getEndpoint(_a) {\r\n    var projectId = _a.projectId;\r\n    return ENDPOINT + \"/projects/\" + projectId + \"/registrations\";\r\n}\r\nfunction getHeaders(_a) {\r\n    var appConfig = _a.appConfig, installations = _a.installations;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, installations.getToken()];\r\n                case 1:\r\n                    authToken = _b.sent();\r\n                    return [2 /*return*/, new Headers({\r\n                            'Content-Type': 'application/json',\r\n                            Accept: 'application/json',\r\n                            'x-goog-api-key': appConfig.apiKey,\r\n                            'x-goog-firebase-installations-auth': \"FIS \" + authToken\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getBody(_a) {\r\n    var p256dh = _a.p256dh, auth = _a.auth, endpoint = _a.endpoint, vapidKey = _a.vapidKey;\r\n    var body = {\r\n        web: {\r\n            endpoint: endpoint,\r\n            auth: auth,\r\n            p256dh: p256dh\r\n        }\r\n    };\r\n    if (vapidKey !== DEFAULT_VAPID_KEY) {\r\n        body.web.applicationPubKey = vapidKey;\r\n    }\r\n    return body;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** UpdateRegistration will be called once every week. */\r\nvar TOKEN_EXPIRATION_MS = 7 * 24 * 60 * 60 * 1000; // 7 days\r\nfunction getToken(firebaseDependencies, swRegistration, vapidKey) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var pushSubscription, tokenDetails, subscriptionOptions, e_1;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (Notification.permission !== 'granted') {\r\n                        throw ERROR_FACTORY.create(\"permission-blocked\" /* PERMISSION_BLOCKED */);\r\n                    }\r\n                    return [4 /*yield*/, getPushSubscription(swRegistration, vapidKey)];\r\n                case 1:\r\n                    pushSubscription = _a.sent();\r\n                    return [4 /*yield*/, dbGet(firebaseDependencies)];\r\n                case 2:\r\n                    tokenDetails = _a.sent();\r\n                    subscriptionOptions = {\r\n                        vapidKey: vapidKey,\r\n                        swScope: swRegistration.scope,\r\n                        endpoint: pushSubscription.endpoint,\r\n                        auth: arrayToBase64(pushSubscription.getKey('auth')),\r\n                        p256dh: arrayToBase64(pushSubscription.getKey('p256dh'))\r\n                    };\r\n                    if (!!tokenDetails) return [3 /*break*/, 3];\r\n                    // No token, get a new one.\r\n                    return [2 /*return*/, getNewToken(firebaseDependencies, subscriptionOptions)];\r\n                case 3:\r\n                    if (!!isTokenValid(tokenDetails.subscriptionOptions, subscriptionOptions)) return [3 /*break*/, 8];\r\n                    _a.label = 4;\r\n                case 4:\r\n                    _a.trys.push([4, 6, , 7]);\r\n                    return [4 /*yield*/, requestDeleteToken(firebaseDependencies, tokenDetails.token)];\r\n                case 5:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 7];\r\n                case 6:\r\n                    e_1 = _a.sent();\r\n                    // Suppress errors because of #2364\r\n                    console.warn(e_1);\r\n                    return [3 /*break*/, 7];\r\n                case 7: return [2 /*return*/, getNewToken(firebaseDependencies, subscriptionOptions)];\r\n                case 8:\r\n                    if (Date.now() >= tokenDetails.createTime + TOKEN_EXPIRATION_MS) {\r\n                        // Weekly token refresh\r\n                        return [2 /*return*/, updateToken({\r\n                                token: tokenDetails.token,\r\n                                createTime: Date.now(),\r\n                                subscriptionOptions: subscriptionOptions\r\n                            }, firebaseDependencies, swRegistration)];\r\n                    }\r\n                    else {\r\n                        // Valid token, nothing to do.\r\n                        return [2 /*return*/, tokenDetails.token];\r\n                    }\r\n                case 9: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * This method deletes the token from the database, unsubscribes the token from FCM, and unregisters\r\n * the push subscription if it exists.\r\n */\r\nfunction deleteToken(firebaseDependencies, swRegistration) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tokenDetails, pushSubscription;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, dbGet(firebaseDependencies)];\r\n                case 1:\r\n                    tokenDetails = _a.sent();\r\n                    if (!tokenDetails) return [3 /*break*/, 4];\r\n                    return [4 /*yield*/, requestDeleteToken(firebaseDependencies, tokenDetails.token)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, dbRemove(firebaseDependencies)];\r\n                case 3:\r\n                    _a.sent();\r\n                    _a.label = 4;\r\n                case 4: return [4 /*yield*/, swRegistration.pushManager.getSubscription()];\r\n                case 5:\r\n                    pushSubscription = _a.sent();\r\n                    if (pushSubscription) {\r\n                        return [2 /*return*/, pushSubscription.unsubscribe()];\r\n                    }\r\n                    // If there's no SW, consider it a success.\r\n                    return [2 /*return*/, true];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction updateToken(tokenDetails, firebaseDependencies, swRegistration) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var updatedToken, updatedTokenDetails, e_2;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 3, , 5]);\r\n                    return [4 /*yield*/, requestUpdateToken(firebaseDependencies, tokenDetails)];\r\n                case 1:\r\n                    updatedToken = _a.sent();\r\n                    updatedTokenDetails = __assign(__assign({}, tokenDetails), { token: updatedToken, createTime: Date.now() });\r\n                    return [4 /*yield*/, dbSet(firebaseDependencies, updatedTokenDetails)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [2 /*return*/, updatedToken];\r\n                case 3:\r\n                    e_2 = _a.sent();\r\n                    return [4 /*yield*/, deleteToken(firebaseDependencies, swRegistration)];\r\n                case 4:\r\n                    _a.sent();\r\n                    throw e_2;\r\n                case 5: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getNewToken(firebaseDependencies, subscriptionOptions) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var token, tokenDetails;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, requestGetToken(firebaseDependencies, subscriptionOptions)];\r\n                case 1:\r\n                    token = _a.sent();\r\n                    tokenDetails = {\r\n                        token: token,\r\n                        createTime: Date.now(),\r\n                        subscriptionOptions: subscriptionOptions\r\n                    };\r\n                    return [4 /*yield*/, dbSet(firebaseDependencies, tokenDetails)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [2 /*return*/, tokenDetails.token];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Gets a PushSubscription for the current user.\r\n */\r\nfunction getPushSubscription(swRegistration, vapidKey) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var subscription;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, swRegistration.pushManager.getSubscription()];\r\n                case 1:\r\n                    subscription = _a.sent();\r\n                    if (subscription) {\r\n                        return [2 /*return*/, subscription];\r\n                    }\r\n                    return [2 /*return*/, swRegistration.pushManager.subscribe({\r\n                            userVisibleOnly: true,\r\n                            // Chrome <= 75 doesn't support base64-encoded VAPID key. For backward compatibility, VAPID key\r\n                            // submitted to pushManager#subscribe must be of type Uint8Array.\r\n                            applicationServerKey: base64ToArray(vapidKey)\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Checks if the saved tokenDetails object matches the configuration provided.\r\n */\r\nfunction isTokenValid(dbOptions, currentOptions) {\r\n    var isVapidKeyEqual = currentOptions.vapidKey === dbOptions.vapidKey;\r\n    var isEndpointEqual = currentOptions.endpoint === dbOptions.endpoint;\r\n    var isAuthEqual = currentOptions.auth === dbOptions.auth;\r\n    var isP256dhEqual = currentOptions.p256dh === dbOptions.p256dh;\r\n    return isVapidKeyEqual && isEndpointEqual && isAuthEqual && isP256dhEqual;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction externalizePayload(internalPayload) {\r\n    var payload = {\r\n        from: internalPayload.from,\r\n        // eslint-disable-next-line camelcase\r\n        collapseKey: internalPayload.collapse_key\r\n    };\r\n    propagateNotificationPayload(payload, internalPayload);\r\n    propagateDataPayload(payload, internalPayload);\r\n    propagateFcmOptions(payload, internalPayload);\r\n    return payload;\r\n}\r\nfunction propagateNotificationPayload(payload, messagePayloadInternal) {\r\n    if (!messagePayloadInternal.notification) {\r\n        return;\r\n    }\r\n    payload.notification = {};\r\n    var title = messagePayloadInternal.notification.title;\r\n    if (!!title) {\r\n        payload.notification.title = title;\r\n    }\r\n    var body = messagePayloadInternal.notification.body;\r\n    if (!!body) {\r\n        payload.notification.body = body;\r\n    }\r\n    var image = messagePayloadInternal.notification.image;\r\n    if (!!image) {\r\n        payload.notification.image = image;\r\n    }\r\n}\r\nfunction propagateDataPayload(payload, messagePayloadInternal) {\r\n    if (!messagePayloadInternal.data) {\r\n        return;\r\n    }\r\n    payload.data = messagePayloadInternal.data;\r\n}\r\nfunction propagateFcmOptions(payload, messagePayloadInternal) {\r\n    if (!messagePayloadInternal.fcmOptions) {\r\n        return;\r\n    }\r\n    payload.fcmOptions = {};\r\n    var link = messagePayloadInternal.fcmOptions.link;\r\n    if (!!link) {\r\n        payload.fcmOptions.link = link;\r\n    }\r\n    // eslint-disable-next-line camelcase\r\n    var analyticsLabel = messagePayloadInternal.fcmOptions.analytics_label;\r\n    if (!!analyticsLabel) {\r\n        payload.fcmOptions.analyticsLabel = analyticsLabel;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction isConsoleMessage(data) {\r\n    // This message has a campaign ID, meaning it was sent using the Firebase Console.\r\n    return typeof data === 'object' && !!data && CONSOLE_CAMPAIGN_ID in data;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a promise that resolves after given time passes. */\r\nfunction sleep(ms) {\r\n    return new Promise(function (resolve) {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar SwController = /** @class */ (function () {\r\n    function SwController(firebaseDependencies) {\r\n        var _this = this;\r\n        this.firebaseDependencies = firebaseDependencies;\r\n        // A boolean flag to determine wether an app is using onBackgroundMessage or\r\n        // setBackgroundMessageHandler. onBackgroundMessage will receive a MessagePayload regardless of if\r\n        // a notification is displayed. Whereas, setBackgroundMessageHandler will swallow the\r\n        // MessagePayload if a NotificationPayload is included.\r\n        this.isOnBackgroundMessageUsed = null;\r\n        this.vapidKey = null;\r\n        this.bgMessageHandler = null;\r\n        self.addEventListener('push', function (e) {\r\n            e.waitUntil(_this.onPush(e));\r\n        });\r\n        self.addEventListener('pushsubscriptionchange', function (e) {\r\n            e.waitUntil(_this.onSubChange(e));\r\n        });\r\n        self.addEventListener('notificationclick', function (e) {\r\n            e.waitUntil(_this.onNotificationClick(e));\r\n        });\r\n    }\r\n    Object.defineProperty(SwController.prototype, \"app\", {\r\n        get: function () {\r\n            return this.firebaseDependencies.app;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * @deprecated. Use onBackgroundMessage(nextOrObserver: NextFn<object> | Observer<object>):\r\n     * Unsubscribe instead.\r\n     *\r\n     * Calling setBackgroundMessageHandler will opt in to some specific behaviors.\r\n     *\r\n     * 1.) If a notification doesn't need to be shown due to a window already being visible, then push\r\n     * messages will be sent to the page. 2.) If a notification needs to be shown, and the message\r\n     * contains no notification data this method will be called and the promise it returns will be\r\n     * passed to event.waitUntil. If you do not set this callback then all push messages will let and\r\n     * the developer can handle them in a their own 'push' event callback\r\n     *\r\n     * @param callback The callback to be called when a push message is received and a notification\r\n     * must be shown. The callback will be given the data from the push message.\r\n     */\r\n    SwController.prototype.setBackgroundMessageHandler = function (callback) {\r\n        this.isOnBackgroundMessageUsed = false;\r\n        if (!callback || typeof callback !== 'function') {\r\n            throw ERROR_FACTORY.create(\"invalid-bg-handler\" /* INVALID_BG_HANDLER */);\r\n        }\r\n        this.bgMessageHandler = callback;\r\n    };\r\n    SwController.prototype.onBackgroundMessage = function (nextOrObserver) {\r\n        var _this = this;\r\n        this.isOnBackgroundMessageUsed = true;\r\n        this.bgMessageHandler = nextOrObserver;\r\n        return function () {\r\n            _this.bgMessageHandler = null;\r\n        };\r\n    };\r\n    // TODO: Remove getToken from SW Controller. Calling this from an old SW can cause all kinds of\r\n    // trouble.\r\n    SwController.prototype.getToken = function () {\r\n        var _a, _b;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var tokenDetails;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        if (!!this.vapidKey) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, dbGet(this.firebaseDependencies)];\r\n                    case 1:\r\n                        tokenDetails = _c.sent();\r\n                        this.vapidKey = (_b = (_a = tokenDetails === null || tokenDetails === void 0 ? void 0 : tokenDetails.subscriptionOptions) === null || _a === void 0 ? void 0 : _a.vapidKey) !== null && _b !== void 0 ? _b : DEFAULT_VAPID_KEY;\r\n                        _c.label = 2;\r\n                    case 2: return [2 /*return*/, getToken(this.firebaseDependencies, self.registration, this.vapidKey)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    // TODO: Remove deleteToken from SW Controller. Calling this from an old SW can cause all kinds of\r\n    // trouble.\r\n    SwController.prototype.deleteToken = function () {\r\n        return deleteToken(this.firebaseDependencies, self.registration);\r\n    };\r\n    SwController.prototype.requestPermission = function () {\r\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    // TODO: Remove this together with getToken from SW Controller.\r\n    SwController.prototype.usePublicVapidKey = function (vapidKey) {\r\n        if (this.vapidKey !== null) {\r\n            throw ERROR_FACTORY.create(\"use-vapid-key-after-get-token\" /* USE_VAPID_KEY_AFTER_GET_TOKEN */);\r\n        }\r\n        if (typeof vapidKey !== 'string' || vapidKey.length === 0) {\r\n            throw ERROR_FACTORY.create(\"invalid-vapid-key\" /* INVALID_VAPID_KEY */);\r\n        }\r\n        this.vapidKey = vapidKey;\r\n    };\r\n    SwController.prototype.useServiceWorker = function () {\r\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    SwController.prototype.onMessage = function () {\r\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    SwController.prototype.onTokenRefresh = function () {\r\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    /**\r\n     * A handler for push events that shows notifications based on the content of the payload.\r\n     *\r\n     * The payload must be a JSON-encoded Object with a `notification` key. The value of the\r\n     * `notification` property will be used as the NotificationOptions object passed to\r\n     * showNotification. Additionally, the `title` property of the notification object will be used as\r\n     * the title.\r\n     *\r\n     * If there is no notification data in the payload then no notification will be shown.\r\n     */\r\n    SwController.prototype.onPush = function (event) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var internalPayload, clientList, isNotificationShown, payload;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        internalPayload = getMessagePayloadInternal(event);\r\n                        if (!internalPayload) {\r\n                            console.debug(TAG +\r\n                                'failed to get parsed MessagePayload from the PushEvent. Skip handling the push.');\r\n                            return [2 /*return*/];\r\n                        }\r\n                        return [4 /*yield*/, getClientList()];\r\n                    case 1:\r\n                        clientList = _a.sent();\r\n                        if (hasVisibleClients(clientList)) {\r\n                            return [2 /*return*/, sendMessagePayloadInternalToWindows(clientList, internalPayload)];\r\n                        }\r\n                        isNotificationShown = false;\r\n                        if (!!!internalPayload.notification) return [3 /*break*/, 3];\r\n                        return [4 /*yield*/, showNotification(wrapInternalPayload(internalPayload))];\r\n                    case 2:\r\n                        _a.sent();\r\n                        isNotificationShown = true;\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        // MessagePayload is only passed to `onBackgroundMessage`. Skip passing MessagePayload for\r\n                        // the legacy `setBackgroundMessageHandler` to preserve the SDK behaviors.\r\n                        if (isNotificationShown === true &&\r\n                            this.isOnBackgroundMessageUsed === false) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        if (!!this.bgMessageHandler) {\r\n                            payload = externalizePayload(internalPayload);\r\n                            if (typeof this.bgMessageHandler === 'function') {\r\n                                this.bgMessageHandler(payload);\r\n                            }\r\n                            else {\r\n                                this.bgMessageHandler.next(payload);\r\n                            }\r\n                        }\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SwController.prototype.onSubChange = function (event) {\r\n        var _a, _b;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var newSubscription, tokenDetails;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        newSubscription = event.newSubscription;\r\n                        if (!!newSubscription) return [3 /*break*/, 2];\r\n                        // Subscription revoked, delete token\r\n                        return [4 /*yield*/, deleteToken(this.firebaseDependencies, self.registration)];\r\n                    case 1:\r\n                        // Subscription revoked, delete token\r\n                        _c.sent();\r\n                        return [2 /*return*/];\r\n                    case 2: return [4 /*yield*/, dbGet(this.firebaseDependencies)];\r\n                    case 3:\r\n                        tokenDetails = _c.sent();\r\n                        return [4 /*yield*/, deleteToken(this.firebaseDependencies, self.registration)];\r\n                    case 4:\r\n                        _c.sent();\r\n                        return [4 /*yield*/, getToken(this.firebaseDependencies, self.registration, (_b = (_a = tokenDetails === null || tokenDetails === void 0 ? void 0 : tokenDetails.subscriptionOptions) === null || _a === void 0 ? void 0 : _a.vapidKey) !== null && _b !== void 0 ? _b : DEFAULT_VAPID_KEY)];\r\n                    case 5:\r\n                        _c.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SwController.prototype.onNotificationClick = function (event) {\r\n        var _a, _b;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var internalPayload, link, url, originUrl, client;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        internalPayload = (_b = (_a = event.notification) === null || _a === void 0 ? void 0 : _a.data) === null || _b === void 0 ? void 0 : _b[FCM_MSG];\r\n                        if (!internalPayload) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        else if (event.action) {\r\n                            // User clicked on an action button. This will allow developers to act on action button clicks\r\n                            // by using a custom onNotificationClick listener that they define.\r\n                            return [2 /*return*/];\r\n                        }\r\n                        // Prevent other listeners from receiving the event\r\n                        event.stopImmediatePropagation();\r\n                        event.notification.close();\r\n                        link = getLink(internalPayload);\r\n                        if (!link) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        url = new URL(link, self.location.href);\r\n                        originUrl = new URL(self.location.origin);\r\n                        if (url.host !== originUrl.host) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        return [4 /*yield*/, getWindowClient(url)];\r\n                    case 1:\r\n                        client = _c.sent();\r\n                        if (!!client) return [3 /*break*/, 4];\r\n                        return [4 /*yield*/, self.clients.openWindow(link)];\r\n                    case 2:\r\n                        client = _c.sent();\r\n                        // Wait three seconds for the client to initialize and set up the message handler so that it\r\n                        // can receive the message.\r\n                        return [4 /*yield*/, sleep(3000)];\r\n                    case 3:\r\n                        // Wait three seconds for the client to initialize and set up the message handler so that it\r\n                        // can receive the message.\r\n                        _c.sent();\r\n                        return [3 /*break*/, 6];\r\n                    case 4: return [4 /*yield*/, client.focus()];\r\n                    case 5:\r\n                        client = _c.sent();\r\n                        _c.label = 6;\r\n                    case 6:\r\n                        if (!client) {\r\n                            // Window Client will not be returned if it's for a third party origin.\r\n                            return [2 /*return*/];\r\n                        }\r\n                        internalPayload.messageType = MessageType.NOTIFICATION_CLICKED;\r\n                        internalPayload.isFirebaseMessaging = true;\r\n                        return [2 /*return*/, client.postMessage(internalPayload)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return SwController;\r\n}());\r\nfunction wrapInternalPayload(internalPayload) {\r\n    var _a;\r\n    var wrappedInternalPayload = __assign({}, internalPayload.notification);\r\n    // Put the message payload under FCM_MSG name so we can identify the notification as being an FCM\r\n    // notification vs a notification from somewhere else (i.e. normal web push or developer generated\r\n    // notification).\r\n    wrappedInternalPayload.data = (_a = {},\r\n        _a[FCM_MSG] = internalPayload,\r\n        _a);\r\n    return wrappedInternalPayload;\r\n}\r\nfunction getMessagePayloadInternal(_a) {\r\n    var data = _a.data;\r\n    if (!data) {\r\n        return null;\r\n    }\r\n    try {\r\n        return data.json();\r\n    }\r\n    catch (err) {\r\n        // Not JSON so not an FCM message.\r\n        return null;\r\n    }\r\n}\r\n/**\r\n * @param url The URL to look for when focusing a client.\r\n * @return Returns an existing window client or a newly opened WindowClient.\r\n */\r\nfunction getWindowClient(url) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var clientList, clientList_1, clientList_1_1, client, clientUrl;\r\n        var e_1, _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, getClientList()];\r\n                case 1:\r\n                    clientList = _b.sent();\r\n                    try {\r\n                        for (clientList_1 = __values(clientList), clientList_1_1 = clientList_1.next(); !clientList_1_1.done; clientList_1_1 = clientList_1.next()) {\r\n                            client = clientList_1_1.value;\r\n                            clientUrl = new URL(client.url, self.location.href);\r\n                            if (url.host === clientUrl.host) {\r\n                                return [2 /*return*/, client];\r\n                            }\r\n                        }\r\n                    }\r\n                    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n                    finally {\r\n                        try {\r\n                            if (clientList_1_1 && !clientList_1_1.done && (_a = clientList_1.return)) _a.call(clientList_1);\r\n                        }\r\n                        finally { if (e_1) throw e_1.error; }\r\n                    }\r\n                    return [2 /*return*/, null];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * @returns If there is currently a visible WindowClient, this method will resolve to true,\r\n * otherwise false.\r\n */\r\nfunction hasVisibleClients(clientList) {\r\n    return clientList.some(function (client) {\r\n        return client.visibilityState === 'visible' &&\r\n            // Ignore chrome-extension clients as that matches the background pages of extensions, which\r\n            // are always considered visible for some reason.\r\n            !client.url.startsWith('chrome-extension://');\r\n    });\r\n}\r\nfunction sendMessagePayloadInternalToWindows(clientList, internalPayload) {\r\n    var e_2, _a;\r\n    internalPayload.isFirebaseMessaging = true;\r\n    internalPayload.messageType = MessageType.PUSH_RECEIVED;\r\n    try {\r\n        for (var clientList_2 = __values(clientList), clientList_2_1 = clientList_2.next(); !clientList_2_1.done; clientList_2_1 = clientList_2.next()) {\r\n            var client = clientList_2_1.value;\r\n            client.postMessage(internalPayload);\r\n        }\r\n    }\r\n    catch (e_2_1) { e_2 = { error: e_2_1 }; }\r\n    finally {\r\n        try {\r\n            if (clientList_2_1 && !clientList_2_1.done && (_a = clientList_2.return)) _a.call(clientList_2);\r\n        }\r\n        finally { if (e_2) throw e_2.error; }\r\n    }\r\n}\r\nfunction getClientList() {\r\n    return self.clients.matchAll({\r\n        type: 'window',\r\n        includeUncontrolled: true\r\n        // TS doesn't know that \"type: 'window'\" means it'll return WindowClient[]\r\n    });\r\n}\r\nfunction showNotification(notificationPayloadInternal) {\r\n    var _a;\r\n    // Note: Firefox does not support the maxActions property.\r\n    // https://developer.mozilla.org/en-US/docs/Web/API/notification/maxActions\r\n    var actions = notificationPayloadInternal.actions;\r\n    var maxActions = Notification.maxActions;\r\n    if (actions && maxActions && actions.length > maxActions) {\r\n        console.warn(\"This browser only supports \" + maxActions + \" actions. The remaining actions will not be displayed.\");\r\n    }\r\n    return self.registration.showNotification((_a = \r\n    /* title= */ notificationPayloadInternal.title) !== null && _a !== void 0 ? _a : '', notificationPayloadInternal);\r\n}\r\nfunction getLink(payload) {\r\n    var _a, _b, _c;\r\n    // eslint-disable-next-line camelcase\r\n    var link = (_b = (_a = payload.fcmOptions) === null || _a === void 0 ? void 0 : _a.link) !== null && _b !== void 0 ? _b : (_c = payload.notification) === null || _c === void 0 ? void 0 : _c.click_action;\r\n    if (link) {\r\n        return link;\r\n    }\r\n    if (isConsoleMessage(payload.data)) {\r\n        // Notification created in the Firebase Console. Redirect to origin.\r\n        return self.location.origin;\r\n    }\r\n    else {\r\n        return null;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar WindowController = /** @class */ (function () {\r\n    function WindowController(firebaseDependencies) {\r\n        var _this = this;\r\n        this.firebaseDependencies = firebaseDependencies;\r\n        this.vapidKey = null;\r\n        this.onMessageCallback = null;\r\n        navigator.serviceWorker.addEventListener('message', function (e) {\r\n            return _this.messageEventListener(e);\r\n        });\r\n    }\r\n    Object.defineProperty(WindowController.prototype, \"app\", {\r\n        get: function () {\r\n            return this.firebaseDependencies.app;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    WindowController.prototype.messageEventListener = function (event) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var internalPayload, dataPayload;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        internalPayload = event.data;\r\n                        if (!internalPayload.isFirebaseMessaging) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        // onMessageCallback is either a function or observer/subscriber.\r\n                        // TODO: in the modularization release, have onMessage handle type MessagePayload as supposed to\r\n                        // the legacy payload where some fields are in snake cases.\r\n                        if (this.onMessageCallback &&\r\n                            internalPayload.messageType === MessageType.PUSH_RECEIVED) {\r\n                            if (typeof this.onMessageCallback === 'function') {\r\n                                this.onMessageCallback(stripInternalFields(Object.assign({}, internalPayload)));\r\n                            }\r\n                            else {\r\n                                this.onMessageCallback.next(Object.assign({}, internalPayload));\r\n                            }\r\n                        }\r\n                        dataPayload = internalPayload.data;\r\n                        if (!(isConsoleMessage(dataPayload) &&\r\n                            dataPayload[CONSOLE_CAMPAIGN_ANALYTICS_ENABLED] === '1')) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.logEvent(internalPayload.messageType, dataPayload)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WindowController.prototype.getVapidKey = function () {\r\n        return this.vapidKey;\r\n    };\r\n    WindowController.prototype.getSwReg = function () {\r\n        return this.swRegistration;\r\n    };\r\n    WindowController.prototype.getToken = function (options) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!(Notification.permission === 'default')) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, Notification.requestPermission()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        if (Notification.permission !== 'granted') {\r\n                            throw ERROR_FACTORY.create(\"permission-blocked\" /* PERMISSION_BLOCKED */);\r\n                        }\r\n                        return [4 /*yield*/, this.updateVapidKey(options === null || options === void 0 ? void 0 : options.vapidKey)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.updateSwReg(options === null || options === void 0 ? void 0 : options.serviceWorkerRegistration)];\r\n                    case 4:\r\n                        _a.sent();\r\n                        return [2 /*return*/, getToken(this.firebaseDependencies, this.swRegistration, this.vapidKey)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WindowController.prototype.updateVapidKey = function (vapidKey) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!!vapidKey) {\r\n                    this.vapidKey = vapidKey;\r\n                }\r\n                else if (!this.vapidKey) {\r\n                    this.vapidKey = DEFAULT_VAPID_KEY;\r\n                }\r\n                return [2 /*return*/];\r\n            });\r\n        });\r\n    };\r\n    WindowController.prototype.updateSwReg = function (swRegistration) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!(!swRegistration && !this.swRegistration)) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.registerDefaultSw()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        if (!swRegistration && !!this.swRegistration) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        if (!(swRegistration instanceof ServiceWorkerRegistration)) {\r\n                            throw ERROR_FACTORY.create(\"invalid-sw-registration\" /* INVALID_SW_REGISTRATION */);\r\n                        }\r\n                        this.swRegistration = swRegistration;\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WindowController.prototype.registerDefaultSw = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, e_1;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _b.trys.push([0, 2, , 3]);\r\n                        _a = this;\r\n                        return [4 /*yield*/, navigator.serviceWorker.register(DEFAULT_SW_PATH, {\r\n                                scope: DEFAULT_SW_SCOPE\r\n                            })];\r\n                    case 1:\r\n                        _a.swRegistration = _b.sent();\r\n                        // The timing when browser updates sw when sw has an update is unreliable by my experiment. It\r\n                        // leads to version conflict when the SDK upgrades to a newer version in the main page, but sw\r\n                        // is stuck with the old version. For example,\r\n                        // https://github.com/firebase/firebase-js-sdk/issues/2590 The following line reliably updates\r\n                        // sw if there was an update.\r\n                        this.swRegistration.update().catch(function () {\r\n                            /* it is non blocking and we don't care if it failed */\r\n                        });\r\n                        return [3 /*break*/, 3];\r\n                    case 2:\r\n                        e_1 = _b.sent();\r\n                        throw ERROR_FACTORY.create(\"failed-service-worker-registration\" /* FAILED_DEFAULT_REGISTRATION */, {\r\n                            browserErrorMessage: e_1.message\r\n                        });\r\n                    case 3: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WindowController.prototype.deleteToken = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!!this.swRegistration) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.registerDefaultSw()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/, deleteToken(this.firebaseDependencies, this.swRegistration)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Request permission if it is not currently granted.\r\n     *\r\n     * @return Resolves if the permission was granted, rejects otherwise.\r\n     *\r\n     * @deprecated Use Notification.requestPermission() instead.\r\n     * https://developer.mozilla.org/en-US/docs/Web/API/Notification/requestPermission\r\n     */\r\n    WindowController.prototype.requestPermission = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var permissionResult;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (Notification.permission === 'granted') {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        return [4 /*yield*/, Notification.requestPermission()];\r\n                    case 1:\r\n                        permissionResult = _a.sent();\r\n                        if (permissionResult === 'granted') {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        else if (permissionResult === 'denied') {\r\n                            throw ERROR_FACTORY.create(\"permission-blocked\" /* PERMISSION_BLOCKED */);\r\n                        }\r\n                        else {\r\n                            throw ERROR_FACTORY.create(\"permission-default\" /* PERMISSION_DEFAULT */);\r\n                        }\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * @deprecated. Use getToken(options?: {vapidKey?: string; serviceWorkerRegistration?:\r\n     * ServiceWorkerRegistration;}): Promise<string> instead.\r\n     */\r\n    WindowController.prototype.usePublicVapidKey = function (vapidKey) {\r\n        if (this.vapidKey !== null) {\r\n            throw ERROR_FACTORY.create(\"use-vapid-key-after-get-token\" /* USE_VAPID_KEY_AFTER_GET_TOKEN */);\r\n        }\r\n        if (typeof vapidKey !== 'string' || vapidKey.length === 0) {\r\n            throw ERROR_FACTORY.create(\"invalid-vapid-key\" /* INVALID_VAPID_KEY */);\r\n        }\r\n        this.vapidKey = vapidKey;\r\n    };\r\n    /**\r\n     * @deprecated. Use getToken(options?: {vapidKey?: string; serviceWorkerRegistration?:\r\n     * ServiceWorkerRegistration;}): Promise<string> instead.\r\n     */\r\n    WindowController.prototype.useServiceWorker = function (swRegistration) {\r\n        if (!(swRegistration instanceof ServiceWorkerRegistration)) {\r\n            throw ERROR_FACTORY.create(\"invalid-sw-registration\" /* INVALID_SW_REGISTRATION */);\r\n        }\r\n        if (this.swRegistration) {\r\n            throw ERROR_FACTORY.create(\"use-sw-after-get-token\" /* USE_SW_AFTER_GET_TOKEN */);\r\n        }\r\n        this.swRegistration = swRegistration;\r\n    };\r\n    /**\r\n     * @param nextOrObserver An observer object or a function triggered on message.\r\n     *\r\n     * @return The unsubscribe function for the observer.\r\n     */\r\n    WindowController.prototype.onMessage = function (nextOrObserver) {\r\n        var _this = this;\r\n        this.onMessageCallback = nextOrObserver;\r\n        return function () {\r\n            _this.onMessageCallback = null;\r\n        };\r\n    };\r\n    WindowController.prototype.setBackgroundMessageHandler = function () {\r\n        throw ERROR_FACTORY.create(\"only-available-in-sw\" /* AVAILABLE_IN_SW */);\r\n    };\r\n    WindowController.prototype.onBackgroundMessage = function () {\r\n        throw ERROR_FACTORY.create(\"only-available-in-sw\" /* AVAILABLE_IN_SW */);\r\n    };\r\n    /**\r\n     * @deprecated No-op. It was initially designed with token rotation requests from server in mind.\r\n     * However, the plan to implement such feature was abandoned.\r\n     */\r\n    WindowController.prototype.onTokenRefresh = function () {\r\n        return function () { };\r\n    };\r\n    WindowController.prototype.logEvent = function (messageType, data) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var eventType, analytics;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        eventType = getEventType(messageType);\r\n                        return [4 /*yield*/, this.firebaseDependencies.analyticsProvider.get()];\r\n                    case 1:\r\n                        analytics = _a.sent();\r\n                        analytics.logEvent(eventType, {\r\n                            /* eslint-disable camelcase */\r\n                            message_id: data[CONSOLE_CAMPAIGN_ID],\r\n                            message_name: data[CONSOLE_CAMPAIGN_NAME],\r\n                            message_time: data[CONSOLE_CAMPAIGN_TIME],\r\n                            message_device_time: Math.floor(Date.now() / 1000)\r\n                            /* eslint-enable camelcase */\r\n                        });\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return WindowController;\r\n}());\r\nfunction getEventType(messageType) {\r\n    switch (messageType) {\r\n        case MessageType.NOTIFICATION_CLICKED:\r\n            return 'notification_open';\r\n        case MessageType.PUSH_RECEIVED:\r\n            return 'notification_foreground';\r\n        default:\r\n            throw new Error();\r\n    }\r\n}\r\nfunction stripInternalFields(internalPayload) {\r\n    delete internalPayload.messageType;\r\n    delete internalPayload.isFirebaseMessaging;\r\n    return internalPayload;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction extractAppConfig(app) {\r\n    var e_1, _a;\r\n    if (!app || !app.options) {\r\n        throw getMissingValueError('App Configuration Object');\r\n    }\r\n    if (!app.name) {\r\n        throw getMissingValueError('App Name');\r\n    }\r\n    // Required app config keys\r\n    var configKeys = [\r\n        'projectId',\r\n        'apiKey',\r\n        'appId',\r\n        'messagingSenderId'\r\n    ];\r\n    var options = app.options;\r\n    try {\r\n        for (var configKeys_1 = __values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\r\n            var keyName = configKeys_1_1.value;\r\n            if (!options[keyName]) {\r\n                throw getMissingValueError(keyName);\r\n            }\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n    return {\r\n        appName: app.name,\r\n        projectId: options.projectId,\r\n        apiKey: options.apiKey,\r\n        appId: options.appId,\r\n        senderId: options.messagingSenderId\r\n    };\r\n}\r\nfunction getMissingValueError(valueName) {\r\n    return ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */, {\r\n        valueName: valueName\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar MESSAGING_NAME = 'messaging';\r\nfunction factoryMethod(container) {\r\n    // Dependencies.\r\n    var app = container.getProvider('app').getImmediate();\r\n    var appConfig = extractAppConfig(app);\r\n    var installations = container.getProvider('installations').getImmediate();\r\n    var analyticsProvider = container.getProvider('analytics-internal');\r\n    var firebaseDependencies = {\r\n        app: app,\r\n        appConfig: appConfig,\r\n        installations: installations,\r\n        analyticsProvider: analyticsProvider\r\n    };\r\n    if (!isSupported()) {\r\n        throw ERROR_FACTORY.create(\"unsupported-browser\" /* UNSUPPORTED_BROWSER */);\r\n    }\r\n    if (self && 'ServiceWorkerGlobalScope' in self) {\r\n        // Running in ServiceWorker context\r\n        return new SwController(firebaseDependencies);\r\n    }\r\n    else {\r\n        // Assume we are in the window context.\r\n        return new WindowController(firebaseDependencies);\r\n    }\r\n}\r\nvar NAMESPACE_EXPORTS = {\r\n    isSupported: isSupported\r\n};\r\nfirebase.INTERNAL.registerComponent(new Component(MESSAGING_NAME, factoryMethod, \"PUBLIC\" /* PUBLIC */).setServiceProps(NAMESPACE_EXPORTS));\r\nfunction isSupported() {\r\n    if (self && 'ServiceWorkerGlobalScope' in self) {\r\n        // Running in ServiceWorker context\r\n        return isSWControllerSupported();\r\n    }\r\n    else {\r\n        // Assume we are in the window context.\r\n        return isWindowControllerSupported();\r\n    }\r\n}\r\n/**\r\n * Checks to see if the required APIs exist.\r\n */\r\nfunction isWindowControllerSupported() {\r\n    return ('indexedDB' in window &&\r\n        indexedDB !== null &&\r\n        navigator.cookieEnabled &&\r\n        'serviceWorker' in navigator &&\r\n        'PushManager' in window &&\r\n        'Notification' in window &&\r\n        'fetch' in window &&\r\n        ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') &&\r\n        PushSubscription.prototype.hasOwnProperty('getKey'));\r\n}\r\n/**\r\n * Checks to see if the required APIs exist within SW Context.\r\n */\r\nfunction isSWControllerSupported() {\r\n    return ('indexedDB' in self &&\r\n        indexedDB !== null &&\r\n        'PushManager' in self &&\r\n        'Notification' in self &&\r\n        ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') &&\r\n        PushSubscription.prototype.hasOwnProperty('getKey'));\r\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}