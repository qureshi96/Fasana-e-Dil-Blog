{"ast":null,"code":"import { stateChanges } from './state-changes';\nimport { fromRef } from '../observable/fromRef';\nimport { skipWhile, withLatestFrom, map, scan } from 'rxjs/operators';\nexport function auditTrail(query, events, scheduler) {\n  const auditTrail$ = stateChanges(query, events).pipe(scan((current, action) => [...current, action], []));\n  return waitForLoaded(query, auditTrail$, scheduler);\n}\n\nfunction loadedData(query, scheduler) {\n  return fromRef(query, 'value', 'on', scheduler).pipe(map(data => {\n    let lastKeyToLoad;\n    data.payload.forEach(child => {\n      lastKeyToLoad = child.key;\n      return false;\n    });\n    return {\n      data,\n      lastKeyToLoad\n    };\n  }));\n}\n\nfunction waitForLoaded(query, action$, scheduler) {\n  const loaded$ = loadedData(query, scheduler);\n  return loaded$.pipe(withLatestFrom(action$), map(([loaded, actions]) => {\n    let lastKeyToLoad = loaded.lastKeyToLoad;\n    const loadedKeys = actions.map(snap => snap.key);\n    return {\n      actions,\n      lastKeyToLoad,\n      loadedKeys\n    };\n  }), skipWhile(meta => meta.loadedKeys.indexOf(meta.lastKeyToLoad) === -1), map(meta => meta.actions));\n}","map":{"version":3,"names":["stateChanges","fromRef","skipWhile","withLatestFrom","map","scan","auditTrail","query","events","scheduler","auditTrail$","pipe","current","action","waitForLoaded","loadedData","data","lastKeyToLoad","payload","forEach","child","key","action$","loaded$","loaded","actions","loadedKeys","snap","meta","indexOf"],"sources":["/Users/usman/Documents/GitHub/Fasana-e-Dil-Blog/node_modules/angularfire2/node_modules/@angular/fire/__ivy_ngcc__/database/es2015/list/audit-trail.js"],"sourcesContent":["import { stateChanges } from './state-changes';\nimport { fromRef } from '../observable/fromRef';\nimport { skipWhile, withLatestFrom, map, scan } from 'rxjs/operators';\nexport function auditTrail(query, events, scheduler) {\n    const auditTrail$ = stateChanges(query, events)\n        .pipe(scan((current, action) => [...current, action], []));\n    return waitForLoaded(query, auditTrail$, scheduler);\n}\nfunction loadedData(query, scheduler) {\n    return fromRef(query, 'value', 'on', scheduler)\n        .pipe(map(data => {\n        let lastKeyToLoad;\n        data.payload.forEach(child => {\n            lastKeyToLoad = child.key;\n            return false;\n        });\n        return { data, lastKeyToLoad };\n    }));\n}\nfunction waitForLoaded(query, action$, scheduler) {\n    const loaded$ = loadedData(query, scheduler);\n    return loaded$\n        .pipe(withLatestFrom(action$), map(([loaded, actions]) => {\n        let lastKeyToLoad = loaded.lastKeyToLoad;\n        const loadedKeys = actions.map(snap => snap.key);\n        return { actions, lastKeyToLoad, loadedKeys };\n    }), skipWhile(meta => meta.loadedKeys.indexOf(meta.lastKeyToLoad) === -1), map(meta => meta.actions));\n}\n"],"mappings":"AAAA,SAASA,YAAT,QAA6B,iBAA7B;AACA,SAASC,OAAT,QAAwB,uBAAxB;AACA,SAASC,SAAT,EAAoBC,cAApB,EAAoCC,GAApC,EAAyCC,IAAzC,QAAqD,gBAArD;AACA,OAAO,SAASC,UAAT,CAAoBC,KAApB,EAA2BC,MAA3B,EAAmCC,SAAnC,EAA8C;EACjD,MAAMC,WAAW,GAAGV,YAAY,CAACO,KAAD,EAAQC,MAAR,CAAZ,CACfG,IADe,CACVN,IAAI,CAAC,CAACO,OAAD,EAAUC,MAAV,KAAqB,CAAC,GAAGD,OAAJ,EAAaC,MAAb,CAAtB,EAA4C,EAA5C,CADM,CAApB;EAEA,OAAOC,aAAa,CAACP,KAAD,EAAQG,WAAR,EAAqBD,SAArB,CAApB;AACH;;AACD,SAASM,UAAT,CAAoBR,KAApB,EAA2BE,SAA3B,EAAsC;EAClC,OAAOR,OAAO,CAACM,KAAD,EAAQ,OAAR,EAAiB,IAAjB,EAAuBE,SAAvB,CAAP,CACFE,IADE,CACGP,GAAG,CAACY,IAAI,IAAI;IAClB,IAAIC,aAAJ;IACAD,IAAI,CAACE,OAAL,CAAaC,OAAb,CAAqBC,KAAK,IAAI;MAC1BH,aAAa,GAAGG,KAAK,CAACC,GAAtB;MACA,OAAO,KAAP;IACH,CAHD;IAIA,OAAO;MAAEL,IAAF;MAAQC;IAAR,CAAP;EACH,CAPY,CADN,CAAP;AASH;;AACD,SAASH,aAAT,CAAuBP,KAAvB,EAA8Be,OAA9B,EAAuCb,SAAvC,EAAkD;EAC9C,MAAMc,OAAO,GAAGR,UAAU,CAACR,KAAD,EAAQE,SAAR,CAA1B;EACA,OAAOc,OAAO,CACTZ,IADE,CACGR,cAAc,CAACmB,OAAD,CADjB,EAC4BlB,GAAG,CAAC,CAAC,CAACoB,MAAD,EAASC,OAAT,CAAD,KAAuB;IAC1D,IAAIR,aAAa,GAAGO,MAAM,CAACP,aAA3B;IACA,MAAMS,UAAU,GAAGD,OAAO,CAACrB,GAAR,CAAYuB,IAAI,IAAIA,IAAI,CAACN,GAAzB,CAAnB;IACA,OAAO;MAAEI,OAAF;MAAWR,aAAX;MAA0BS;IAA1B,CAAP;EACH,CAJqC,CAD/B,EAKHxB,SAAS,CAAC0B,IAAI,IAAIA,IAAI,CAACF,UAAL,CAAgBG,OAAhB,CAAwBD,IAAI,CAACX,aAA7B,MAAgD,CAAC,CAA1D,CALN,EAKoEb,GAAG,CAACwB,IAAI,IAAIA,IAAI,CAACH,OAAd,CALvE,CAAP;AAMH"},"metadata":{},"sourceType":"module"}